/*! License information can be found in https://raw.githubusercontent.com/markeaze/markeaze-js-chat-client/master/dist/mkz-chat-client.js.LICENSE */
!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}e.exports=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}},function(e,t,n){var i=n(15),r=n(16),s=n(17),o=n(19);e.exports=function(e,t){return i(e)||r(e,t)||s(e,t)||o()}},function(e,t,n){var i=n(20).markdown;e.exports={removeClass:function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},addClass:function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},appendHTML:function(e,t){var n=document.createElement("div");n.innerHTML=t;var i=this.getFirstChild(n);return e.appendChild(i),i},beforeHTML:function(e,t){var n=document.createElement("div");n.innerHTML=t;var i=this.getFirstChild(n);return e.parentNode.insertBefore(i,e),i},getFirstChild:function(e){for(var t=e.firstChild;null!=t&&3==t.nodeType;)t=t.nextSibling;return t},htmlToText:function(e){var t=document.createElement("div");return t.textContent=e||"",t.innerHTML},srcset:function(e){if(/^data:/i.test(e))return"";var t=function(e,t){var n=e.split("/"),i=n.length-1;return n[i]="x".concat(t,"_").concat(n[i]),"".concat(n.join("/")," ").concat(t,"x")};return"".concat(t(e,2),", ").concat(t(e,3))},br:function(e){return(e||"").split("\n").join("<br />")},htmlFormatting:function(e){return e?this.linkify(this.br(i.toHTML(e))):""},textFormatting:function(e){return this.htmlFormatting(this.htmlToText(e))},getUrlParameter:function(e){if(regex=new RegExp("[?&]"+e+"=([^&#]*)"),results=regex.exec(location.search),null!==results)return decodeURIComponent(results[1].replace(/\+/g," "))},linkify:function(e){if(!e)return e;return e=(e=(e=e.replace(/([^"'])(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])([^"']?)/gim,'$1<a href="$2" target="_blank">$2</a>$4')).replace(/([^"']|^|[^\/])(www\.[\S]+(\b|$))([^"']?)/gim,'$1<a href="http://$2" target="_blank">$2</a>$4')).replace(/([^"'])(([a-zA-Z_-]+\.)*[a-zA-Z_-]+@([a-zA-Z_-]+\.)*[a-zA-Z_-]+\.[a-zA-Z]{2,6})([^"']?)/gim,'$1<a href="mailto:$2">$2</a>$5')},isBrokenIosViewport:function(){return/iPad|iPhone|iPod/.test(navigator.platform)},getOrientation:function(){switch(window.orientation?window.orientation:window.screen&&window.screen.orientation&&window.screen.orientation.angle){case-90:case 90:return"landscape";default:return"portrait"}},getScale:function(){window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;return window.visualViewport&&!this.isBrokenIosViewport()?window.visualViewport.width/window.screen.width:"landscape"===this.getOrientation()?window.innerWidth/window.screen.height:window.innerWidth/window.screen.width},formatFileSize:function(e,t){if(0===e)return"0 Bytes";var n=t||2,i=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,i)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}}},function(e,t){e.exports={guid:0,fixEvent:function(e){if((e=e||window.event).isFixed)return e;if(e.isFixed=!0,e.preventDefault=e.preventDefault||function(){this.returnValue=!1},e.stopPropagation=e.stopPropagaton||function(){this.cancelBubble=!0},e.target||(e.target=e.srcElement),!e.relatedTarget&&e.fromElement&&(e.relatedTarget=e.fromElement==e.target?e.toElement:e.fromElement),null==e.pageX&&null!=e.clientX){var t=document.documentElement,n=document.body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t.clientTop||0)}return!e.which&&e.button&&(e.which=1&e.button?1:2&e.button?3:4&e.button?2:0),e},commonHandle:function(e,t){e=t.fixEvent(e);var n=this.events[e.type];for(var i in n){if(!1===n[i].call(this,e)&&(e.preventDefault(),e.stopPropagation()),e.stopNow)break}},add:function(e,t,n){var i=this;e.setInterval&&e!=window&&!e.frameElement&&(e=window),n.guid||(n.guid=++this.guid),e.events||(e.events={},e.handle=function(t){return i.commonHandle.call(e,t,i)}),e.events[t]||(e.events[t]={},e.addEventListener?e.addEventListener(t,e.handle,!1):e.attachEvent&&e.attachEvent("on"+t,e.handle)),e.events[t][n.guid]=n},remove:function(e,t,n){var i=e.events&&e.events[t];if(i){for(var r in delete i[n.guid],i)return;for(var r in e.removeEventListener?e.removeEventListener(t,e.handle,!1):e.detachEvent&&e.detachEvent("on"+t,e.handle),delete e.events[t],e.events)return;try{delete e.handle,delete e.events}catch(t){e.removeAttribute("handle"),e.removeAttribute("events")}}}}},function(e,t){e.exports={ru:{copyright:"Сделано в Markeaze",placeholder:"Напишите ваше сообщение...",view_product:"Посмотреть товар",add_to_cart:"Добавить в корзину",added_to_cart:"Добавлен в корзину",true:"Да",false:"Нет",new_message:"New message...",dateTime:"dd.mm.yyyy, HH:MM",time:"HH:MM",paginate:"из"},en:{copyright:"Powered by Markeaze",placeholder:"Type your message here...",view_product:"View product",add_to_cart:"Add to cart",added_to_cart:"Added to Cart!",true:"True",false:"False",new_message:"Новое сообщение...",dateTime:"mmm dd yyyy, h:MM tt",time:"h:MM tt",paginate:"of"}}},function(e,t,n){var i=n(7);e.exports={name:"mkz_c_msg_history",cached:!1,history:[],getHistory:function(){if(this.cached&&i.cached)return this.history;this.cached=!0;var e=localStorage.getItem(this.name),t=[];try{t=JSON.parse(e)||[]}catch(e){}return this.history=this.sortHistory(t.concat(i.getHistory())),this.history},saveHistory:function(e){return this.cached=!1,localStorage.setItem(this.name,JSON.stringify(e.filter((function(e){return!e.exclude})))),e},addMsg:function(e){var t=this.getHistory(),n=this.findMsgIndex(e.muid),i={muid:e.muid,msg_type:e.msg_type,text:e.text,custom_fields:e.custom_fields,agent_id:e.agent_id,sender_type:e.sender_type,sent_at:e.sent_at,sender_avatar_url:e.sender_avatar_url,sender_name:e.sender_name,attachments:e.attachments,exclude:e.exclude};-1===n?t.push(i):t[n]=i,this.saveHistory(t)},getNextMsg:function(e){var t=this.findMsgIndex(e),n=this.getHistory();if(n[t+1])return n[t+1]},batchUpdateMsg:function(e,t){var n=this.getHistory(),i=n.filter(e);return i.map(t),this.saveHistory(n),i},findMsgIndex:function(e){return this.getHistory().findIndex((function(t){return t.muid===e}))},findMsg:function(e){return this.getHistory().find((function(t){return t.muid===e}))},sortHistory:function(e){for(var t=1,n=e.length;t<n;t++){for(var i=e[t],r=t;r>0&&new Date(e[r-1].sent_at)>new Date(i.sent_at);)e[r]=e[r-1],r--;e[r]=i}return e}}},function(e,t,n){function i(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s,o=!0,a=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw s}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var s=n(13);e.exports={cached:!1,init:function(e){var t=this;this.app=e,this.libs=e.libs,this.cached=!1,this.items=s.getItems(),this.rendered=!1,this.libs.eEmit.subscribe("plugin.chat.auto_messages",this.saveItems.bind(this)),this.libs.eEmit.subscribe("plugin.chat.channel.entered",(function(){t.rendered=!0,t.renderNewItems()}))},getHistory:function(){return this.cached=!0,this.items.map((function(e){return e.payload}))},saveItems:function(e){var t=this;if(0!==e.length){this.cached=!1;var n=this.app.store.uid;this.items=s.addItems(e.map((function(e){var i=t.app.getDateTime(),r=+new Date(i),s=t.app.getAgent(e.sender_id);return{payload:{auto_message_uid:e.uid,agent_id:e.sender_id,attachments:[],muid:"".concat(n,":a:").concat(r),msg_type:"message:auto",sender_type:e.sender_type,sender_avatar_url:s?s.avatar_url:null,sender_name:s?s.name:null,sent_at:i,text:e.text,exclude:!0,custom_fields:e},state:"new",sent_at:i}}))),this.rendered&&this.renderNewItems()}},renderNewItems:function(){var e=this.items.filter((function(e){return"new"===e.state}));if(0!==e.length){this.cached=!1;var t,n=i(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,o=r.payload;this.app.addMsg(o),o.agent_id&&this.app.setCurrentAgent(o.agent_id),this.trackShow(o.custom_fields.uid),r.state="sent"}}catch(e){n.e(e)}finally{n.f()}this.app.view.showChat(),s.setItems(this.items)}},removeItem:function(e){this.cached=!1,this.items=s.removeItem(e)},trackShow:function(e){mkz("trackAutoMessageShow",{auto_message_uid:e})},trackReply:function(e){var t=this.items.find((function(t){return t.payload.muid===e}));if(t){var n=t.payload.custom_fields;mkz("trackAutoMessageReply",{auto_message_uid:n.uid,reply_text:n.text,reply_once:n.reply_once})}}}},function(e,t){e.exports={name:"mkz_c_delivered",addItem:function(e){var t=this.getList();return t.push(e),this.setList(t),t},getList:function(){var e=localStorage.getItem(this.name),t=[];try{t=JSON.parse(e)||[]}catch(e){}return t},setList:function(e){return localStorage.setItem(this.name,JSON.stringify(e)),e},resetList:function(){this.setList([])}}},function(e,t){e.exports="[mkz]{line-height:1}[mkz] html,[mkz] body,[mkz] div,[mkz] span,[mkz] applet,[mkz] object,[mkz] iframe,[mkz] h1,[mkz] h2,[mkz] h3,[mkz] h4,[mkz] h5,[mkz] h6,[mkz] p,[mkz] blockquote,[mkz] pre,[mkz] a,[mkz] abbr,[mkz] acronym,[mkz] address,[mkz] big,[mkz] cite,[mkz] code,[mkz] del,[mkz] dfn,[mkz] em,[mkz] img,[mkz] ins,[mkz] kbd,[mkz] q,[mkz] s,[mkz] samp,[mkz] small,[mkz] strike,[mkz] strong,[mkz] sub,[mkz] sup,[mkz] tt,[mkz] var,[mkz] b,[mkz] u,[mkz] i,[mkz] center,[mkz] dl,[mkz] dt,[mkz] dd,[mkz] ol,[mkz] ul,[mkz] li,[mkz] fieldset,[mkz] form,[mkz] label,[mkz] legend,[mkz] table,[mkz] caption,[mkz] tbody,[mkz] tfoot,[mkz] thead,[mkz] tr,[mkz] th,[mkz] td,[mkz] article,[mkz] aside,[mkz] canvas,[mkz] details,[mkz] embed,[mkz] figure,[mkz] figcaption,[mkz] footer,[mkz] header,[mkz] hgroup,[mkz] menu,[mkz] nav,[mkz] output,[mkz] ruby,[mkz] section,[mkz] summary,[mkz] time,[mkz] mark,[mkz] audio,[mkz] video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline;color:inherit;font-weight:inherit;text-transform:inherit;max-width:none}[mkz] label,[mkz] legend{width:auto;height:auto}[mkz] input,[mkz] select,[mkz] textarea,[mkz] button{margin:0;padding:0;font-size:100%;font:inherit;vertical-align:baseline;background-image:none;outline:none}[mkz] article,[mkz] aside,[mkz] details,[mkz] figcaption,[mkz] figure,[mkz] footer,[mkz] header,[mkz] hgroup,[mkz] menu,[mkz] nav,[mkz] section{display:block}[mkz] ol,[mkz] ul{list-style:none}[mkz] blockquote,[mkz] q{quotes:none}[mkz] blockquote:before,[mkz] blockquote:after,[mkz] q:before,[mkz] q:after{content:'';content:none}[mkz] table{border-collapse:collapse;border-spacing:0}[mkz] .mkz-c{text-align:left;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;font-size:15px;color:#333;display:none}[mkz] .mkz-c *{font-family:Geneva,Arial,Helvetica,sans-serif;-webkit-tap-highlight-color:transparent}[mkz] .mkz-c_display_yes{display:block}[mkz] .mkz-c_valid-message_yes .mkz-c__footer-btn{display:block}[mkz] .mkz-c_chat_show .mkz-c__chat{opacity:1;visibility:visible}[mkz] .mkz-c_beacon_show .mkz-c__handler{opacity:1;visibility:visible}[mkz] .mkz-c_beacon_show .mkz-c__btn{animation-play-state:paused}[mkz] .mkz-c_beacon_show.mkz-c_tooltip_yes .mkz-c__tooltip{opacity:1;visibility:visible}[mkz] .mkz-c_agent_online .mkz-c__state{background-color:#0EC52C;display:block}[mkz] .mkz-c_agent_online .mkz-c__btn-text-online{display:block}[mkz] .mkz-c_agent_online .mkz-c__btn-text-offline{display:none}[mkz] .mkz-c__handler{transition:opacity 0.2s linear, visibility 0.4s 0s linear;opacity:0;visibility:hidden;position:fixed;z-index:20000000}[mkz] .mkz-c__handler_position_l-t{left:0;top:0}[mkz] .mkz-c__handler_position_r-t{right:0;top:0}[mkz] .mkz-c__handler_position_l-b{left:0;bottom:0}[mkz] .mkz-c__handler_position_r-b{right:0;bottom:0}[mkz] .mkz-c__handler_type_bubble .mkz-c__btn-1,[mkz] .mkz-c__handler_type_bubble .mkz-c__btn-2,[mkz] .mkz-c__handler_type_bubble .mkz-c__btn-3{rx:0}[mkz] .mkz-c__handler_type_bubble .mkz-c__btn-2,[mkz] .mkz-c__handler_type_bubble .mkz-c__btn-3{opacity:0;rx:10}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_bouncing_yes .mkz-c__btn-1,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_bouncing_yes .mkz-c__btn-2,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_bouncing_yes .mkz-c__btn-3{transform-origin:50% 50%}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_bouncing_yes .mkz-c__btn-1{animation:mkzBounceAnim1 8s infinite forwards}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_bouncing_yes .mkz-c__btn-2{animation:mkzBounceAnim2 8s infinite forwards}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_bouncing_yes .mkz-c__btn-3{animation:mkzBounceAnim3 8s infinite forwards}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip{left:100%;right:auto;margin-left:15px;margin-right:0;border-radius:0 6px 6px 0}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip:after,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip:after{left:-10px;right:auto;transform:rotate(180deg)}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip:before,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip:before{left:-1px;right:auto}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip_picture_yes,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip_picture_yes{padding-left:5px;padding-right:40px}[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-t .mkz-c__tooltip-picture,[mkz] .mkz-c__handler_type_bubble.mkz-c__handler_position_l-b .mkz-c__tooltip-picture{position:absolute;left:auto;right:-35px}[mkz] .mkz-c__handler_type_bubble .mkz-c__btn{width:60px;height:60px;border-radius:25px 25px 0 25px;background-color:#eee;color:#000;display:flex;align-items:center;justify-content:center;transition:transform 0.2s linear;box-shadow:0 0 10px rgba(25,25,29,0.25)}[mkz] .mkz-c__handler_type_bubble .mkz-c__btn:hover{transform:scale(1.1);animation-play-state:paused}[mkz] .mkz-c__handler_type_bubble .mkz-c__btn-text{display:none}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip{position:absolute;right:100%;top:50%;margin-right:15px;transform:translateY(-50%);box-shadow:0 0 10px rgba(25,25,29,0.25);color:#fff;background:#4F4F4F;padding:5px;border-radius:6px 0 0 6px;width:160px;box-sizing:border-box}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip:after{content:'';position:absolute;right:-10px;top:0;bottom:0;width:10px;clip-path:polygon(0 0, 0 0, 100% 50%, 0 100%);background:inherit;box-shadow:0 0 10px rgba(25,25,29,0.25)}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip:before{content:'';position:absolute;right:-1px;top:1px;bottom:1px;width:2px;background:inherit}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip_picture_yes{padding-left:40px}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip-text{font-size:12px;line-height:16px;text-align:center;max-width:100%;overflow:hidden;text-overflow:ellipsis}[mkz] .mkz-c__handler_type_bubble .mkz-c__tooltip-picture{position:absolute;left:-35px;top:50%;transform:translateY(-50%);max-width:79px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_bouncing_yes .mkz-c__btn{animation:mkzBounceSmScale  5s infinite linear}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t{margin-top:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t{margin-top:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-b{margin-bottom:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-b{margin-bottom:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t .mkz-c__btn,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t .mkz-c__btn{border-radius:0 0 15px 15px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t .mkz-c__btn:hover,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t .mkz-c__btn:hover{padding-top:20px;padding-bottom:8px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t .mkz-c__tooltip,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t .mkz-c__tooltip{bottom:auto;top:100%;margin-top:25px;margin-bottom:0;border-radius:0 0 6px 6px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l-t .mkz-c__tooltip:after,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r-t .mkz-c__tooltip:after{content:'';position:absolute;left:0;right:0;bottom:100%;top:auto;transform:rotate(180deg)}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_t .mkz-c__btn,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l .mkz-c__btn{border-radius:0 0 15px 15px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_t .mkz-c__btn:hover,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l .mkz-c__btn:hover{padding-top:20px;padding-bottom:8px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_t .mkz-c__tooltip,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l .mkz-c__tooltip{bottom:auto;top:100%;margin-top:25px;margin-bottom:0;border-radius:0 0 6px 6px}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_t .mkz-c__tooltip:after,[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l .mkz-c__tooltip:after{content:'';position:absolute;left:0;right:0;bottom:100%;top:auto;transform:rotate(180deg)}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_t{right:0;top:0;margin-top:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_l{transform:rotate(-90deg) translateX(-100%);transform-origin:0 0;left:0;top:0;margin-left:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_r{transform:rotate(-90deg) translateY(-100%);transform-origin:100% 0;right:0;top:0;margin-right:0 !important}[mkz] .mkz-c__handler_type_bar.mkz-c__handler_position_b{right:0;bottom:0;margin-bottom:0 !important}[mkz] .mkz-c__handler_type_bar .mkz-c__tooltip-picture{display:none}[mkz] .mkz-c__handler_type_bar .mkz-c__btn{display:flex;align-items:center;padding:8px 20px;border-radius:15px 15px 0 0;transition:padding 0.2s ease-out}[mkz] .mkz-c__handler_type_bar .mkz-c__btn:hover{padding-bottom:20px;animation-play-state:paused}[mkz] .mkz-c__handler_type_bar .mkz-c__btn-text{flex:1;font-size:14px;line-height:18px;font-weight:600;max-width:230px;min-height:18px}[mkz] .mkz-c__handler_type_bar .mkz-c__btn-text-online,[mkz] .mkz-c__handler_type_bar .mkz-c__btn-text-offline{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}[mkz] .mkz-c__handler_type_bar .mkz-c__btn-picture{flex:0 0 14px;height:14px;margin-left:5px}[mkz] .mkz-c__handler_type_bar .mkz-c__tooltip{position:absolute;bottom:100%;right:0;margin-bottom:25px;box-shadow:0 0 10px rgba(25,25,29,0.25);color:#fff;background:#7261FF;padding:30px 5px;border-radius:6px 6px 0 0;min-width:47px;max-width:80px;box-sizing:border-box;font-weight:600;font-size:16px;line-height:18px;text-align:center}[mkz] .mkz-c__handler_type_bar .mkz-c__tooltip:after{content:'';position:absolute;left:0;right:0;top:100%;height:20px;clip-path:polygon(0 0, 50% 100%, 100% 0, 0 0);background:inherit;box-shadow:0 0 10px rgba(25,25,29,0.25);margin:-1px 0}[mkz] .mkz-c__handler_type_bar .mkz-c__tooltip .mkz-c__tooltip-text{overflow:hidden;text-overflow:ellipsis}[mkz] .mkz-c__btn-text-online{display:none}[mkz] .mkz-c__btn-text-offline{display:block}[mkz] .mkz-c__tooltip{opacity:0;visibility:hidden;transition:opacity 0.2s linear, visibility 0.4s 0s linear}[mkz] .mkz-c__submit{cursor:pointer;transition:all linear 0.2s;opacity:1;color:#FC6881;margin:-1px 0}[mkz] .mkz-c__submit_disabled_yes{cursor:default;opacity:0.5}[mkz] .mkz-c__chat{transition:opacity 0.2s linear, visibility 0.4s 0s linear;opacity:0;visibility:hidden;position:fixed;right:0;bottom:0;width:100%;max-width:401px;max-height:738px;height:100vh;z-index:20000000}[mkz] .mkz-c__chat_position_left{left:0;right:auto}[mkz] .mkz-c__chat_position_left .mkz-c__cart,[mkz] .mkz-c__chat_position_left .mkz-c__cart-shadow{right:0;left:25px}[mkz] .mkz-c__cart,[mkz] .mkz-c__cart-shadow{position:absolute;left:0;top:25px;right:25px;bottom:25px;display:flex;justify-content:stretch;flex-direction:column;border-radius:6px;z-index:5}[mkz] .mkz-c__cart-shadow{z-index:0;box-shadow:0 0 10px rgba(25,25,29,0.25);opacity:0.75}[mkz] .mkz-c__head,[mkz] .mkz-c__docs,[mkz] .mkz-c__footer{padding:0 24px}[mkz] .mkz-c__head,[mkz] .mkz-c__docs,[mkz] .mkz-c__footer{flex:0}[mkz] .mkz-c__content,[mkz] .mkz-c__docs{background-color:#fff}[mkz] .mkz-c__content{flex:1;position:relative}[mkz] .mkz-c__scroll{overflow:hidden;overflow-y:auto;position:absolute;left:0;top:0;right:0;bottom:0;padding:0 16px}[mkz] .mkz-c__head{border-bottom:1px solid #E0E0E0;padding-top:2px;padding-bottom:2px;border-radius:6px 6px 0 0;box-sizing:border-box}[mkz] .mkz-c__head-row{display:flex;align-items:center;margin:14px 0}[mkz] .mkz-c__head-title{flex:1;font-weight:bold;font-size:17px;line-height:22px;height:22px;white-space:nowrap}[mkz] .mkz-c__head-state{flex:0;padding-right:14px}[mkz] .mkz-c__head-m{flex:1;overflow:hidden}[mkz] .mkz-c__head-action{flex:0;position:relative;right:-10px}[mkz] .mkz-c__copy-wrap{text-align:center;margin-top:-35px}[mkz] .mkz-c__copy{display:inline-block;font-size:10px;line-height:16px;color:#787878;text-decoration:none;padding:9px}[mkz] .mkz-c__copy:hover{text-decoration:none}[mkz] .mkz-c__copy-logo{display:inline-block;vertical-align:middle;margin-right:4px}[mkz] .mkz-c__overflow{text-overflow:ellipsis;overflow:hidden}[mkz] .mkz-c__m-assign-text{font-weight:600;font-size:14px;line-height:20px}[mkz] .mkz-c__m-assign-post{font-size:13px;line-height:15px;margin-top:2px}[mkz] .mkz-c__m-assign-avatar{width:40px;height:40px;border-radius:17px 17px 0 17px;border:1px solid #fff;background-color:#fff;overflow:hidden}[mkz] .mkz-c__unmute{display:none}[mkz] .mkz-c_mute_yes .mkz-c__unmute{display:block}[mkz] .mkz-c_mute_yes .mkz-c__mute{display:none}[mkz] .mkz-c__close,[mkz] .mkz-c__unmute,[mkz] .mkz-c__mute{cursor:pointer;padding:10px;margin:-10px 0;opacity:0.7;transition:all linear 0.2s}[mkz] .mkz-c__close:hover,[mkz] .mkz-c__unmute:hover,[mkz] .mkz-c__mute:hover{opacity:1}[mkz] .mkz-c__state-wrap{position:relative}[mkz] .mkz-c__state{position:absolute;right:-3px;bottom:0;width:7px;height:7px;border-radius:50%;background-color:red;transition:background 0.5s linear;border:1px solid #fff;display:none}[mkz] .mkz-c__footer{border-top:1px solid #E0E0E0;display:flex;align-items:center;padding-top:23px;padding-bottom:22px;background-color:#fff;border-radius:0 0 6px 6px}[mkz] .mkz-c__footer-msg{flex:1}[mkz] .mkz-c__footer-btn{flex:0;display:none}[mkz] .mkz-c__input,[mkz] .mkz-c__input:hover,[mkz] .mkz-c__input:focus{display:block;width:100%;resize:none;padding:0;font-size:14px;line-height:1.2em;font-family:Geneva,Arial,Helvetica,sans-serif;color:#333;border-style:none;outline-style:none;background-color:transparent;overflow:hidden;max-height:50vh;min-height:20px;height:0;-webkit-appearance:none;box-shadow:none}[mkz] .mkz-c__btn{color:#FC6881;cursor:pointer}[mkz] .mkz-c__btn-unread{background-color:red;width:16px;height:16px;font-size:8px;line-height:16px;text-align:center;color:#fff;overflow:hidden;position:absolute;right:-5px;top:-5px;border-radius:50%;box-shadow:0 0 1px 2px #fff}[mkz] .mkz-c__list{padding:20px 0;min-height:100%;box-sizing:border-box}[mkz] .mkz-c__i{display:flex;margin:15px 0}[mkz] .mkz-c__i-avatar{display:flex;align-items:flex-end;flex:0 0 44px;padding-bottom:21px}[mkz] .mkz-c__i-info{font-size:11px;line-height:16px;color:#787878;margin-top:5px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}[mkz] .mkz-c__i_type_agent{padding-right:7px}[mkz] .mkz-c__i_type_client{padding-left:7px;flex-direction:row-reverse;text-align:right}[mkz] .mkz-c__i_type_client .mkz-c__i-avatar{display:none;background-color:#E7FEEA}[mkz] .mkz-c__i_type_client .mkz-c__i-msg{background-color:#fff;border-radius:6px 6px 0 6px}[mkz] .mkz-c__i-content{flex:1;overflow:hidden;padding:5px;margin:-5px}[mkz] .mkz-c__i-avatar-img{width:32px;height:32px;border-radius:11px 11px 0 11px;box-shadow:0px 0px 6px rgba(120,120,120,0.25),0px 0px 1px rgba(120,120,120,0.1)}[mkz] .mkz-c__i-msg-block:not(:last-child){margin-bottom:8px}[mkz] .mkz-c__i-msg{display:inline-block;text-align:left;background-color:#E7FEEA;border-radius:6px 6px 6px 0;padding:14px 16px;font-size:14px;line-height:20px;max-width:100%;box-sizing:border-box}[mkz] .mkz-c__i-msg h1{font-size:28px}[mkz] .mkz-c__i-msg h2{font-size:26px}[mkz] .mkz-c__i-msg h3{font-size:22px}[mkz] .mkz-c__i-msg h4{font-size:20px}[mkz] .mkz-c__i-msg h5{font-size:18px}[mkz] .mkz-c__i-msg h6{font-size:16px}[mkz] .mkz-c__i-msg strong{font-weight:bold}[mkz] .mkz-c__i-msg em{font-style:italic}[mkz] .mkz-c__i-msg code{color:#e83e8c}[mkz] .mkz-c__i-msg p{margin:0;padding:0}[mkz] .mkz-c__i-msg a{color:inherit;text-decoration:underline}[mkz] .mkz-c__i-msg a:hover{color:inherit;text-decoration:none}[mkz] .mkz-c__i-msg-overflow{padding:0 2px;margin:0 -2px}[mkz] .mkz-c__i-msg-overflow,[mkz] .mkz-c__i-msg-overflow p,[mkz] .mkz-c__i-msg-overflow code{overflow:hidden;text-overflow:ellipsis}[mkz] .mkz-c-docs{margin:10px -3px;overflow:hidden}[mkz] .mkz-c-docs__list{display:flex}[mkz] .mkz-c-docs__i{flex:1;padding:0 3px;box-sizing:border-box}[mkz] .mkz-c-docs__btn{cursor:pointer;font-size:11px;line-height:1.2em;color:#333;background-color:#F0F0F1;border:1px solid #E0E0E0;border-radius:10px;text-align:center;padding:4px 15px;display:block;width:100%;box-sizing:border-box;white-space:nowrap}[mkz] .mkz-c-docs__btn:hover{background-color:#E0E0E1}[mkz] .mkz-f{max-width:281px;padding:14px 16px;box-sizing:border-box;margin:0;box-shadow:0px 0px 6px rgba(120,120,120,0.25),0px 0px 1px rgba(120,120,120,0.1);background-color:#fff;border-radius:6px}[mkz] .mkz-f__row:not(:last-child){margin-bottom:8px}[mkz] .mkz-f__label{display:block;font-size:13px;line-height:15px;margin-bottom:4px}[mkz] .mkz-f__control_type_success{position:relative}[mkz] .mkz-f__control_type_success:after{content:'';background-image:url(\"data:image/svg+xml,%3Csvg width='18' height='13' viewBox='0 0 18 13' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 9.81305L16.192 0.672287L17.607 2.07825L7 12.625L0.636002 6.29714L2.05 4.89118L7 9.81305Z' fill='%2317B055'/%3E%3C/svg%3E\");background-repeat:no-repeat;background-size:17px 12px;width:17px;height:12px;position:absolute;right:14px;top:50%;margin-top:-6px}[mkz] .mkz-f__input,[mkz] .mkz-f__select{display:block;width:100%;box-sizing:border-box;resize:none;padding:0 0 0 10px;font-size:14px;line-height:38px;height:40px;font-family:Geneva,Arial,Helvetica,sans-serif;color:#333;outline-style:none;background-color:#fff;border-radius:6px;border:1px solid #DFDFDF;overflow:hidden;-webkit-appearance:none}[mkz] .mkz-f__input[disabled],[mkz] .mkz-f__select[disabled]{color:#333333;background-color:#FAFAFA;border-color:#FAFAFA}[mkz] .mkz-f__select{appearance:none;-moz-appearance:none;-webkit-appearance:none;position:relative;background-image:url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='50' fill='%23000000'><polygon points='0,0 100,0 50,50'/></svg>\");background-repeat:no-repeat;background-position:calc(100% - 10px) center;background-size:10px}[mkz] .mkz-f__select[disabled]{background-image:none}[mkz] .mkz-f__note{font-size:12px;line-height:16px;color:#787878}[mkz] .mkz-f__btn,[mkz] .mkz-c-o__btn{display:block;width:100%;box-sizing:border-box;font-weight:600;font-size:14px;line-height:1.2em;color:#fff;background-color:#FC6881;border-radius:6px;border-style:none;padding:16px;text-align:center;outline-style:none;text-decoration:none;cursor:pointer;transition:all linear 0.2s}[mkz] .mkz-f__btn[disabled],[mkz] .mkz-f__btn[disabled]:hover,[mkz] .mkz-c-o__btn[disabled],[mkz] .mkz-c-o__btn[disabled]:hover{background-color:#e57f90;color:#aaa;cursor:default}[mkz] .mkz-f__btn:hover,[mkz] .mkz-c-o__btn:hover{text-decoration:none;background-color:#fb3657}[mkz] .mkz-f__invalid,[mkz] .mkz-f__invalid::placeholder{color:red !important;box-shadow:0 0 1px 1px red !important}[mkz] .mkz-c-o__i{width:192px}[mkz] .mkz-c-o__i:not(:last-child){margin-bottom:20px}[mkz] .mkz-c-o__btn{padding:12px 16px}[mkz] .mkz-c-o__content{padding:16px;border:1px solid #E0E0E0;border-radius:6px}[mkz] .mkz-c-o__preview-link{display:flex;align-items:center;justify-content:center;height:128px;margin-bottom:10px}[mkz] .mkz-c-o__preview-img{display:block;max-width:100%;max-height:100%;color:#787878}[mkz] .mkz-c-o__name{font-size:14px;line-height:20px;margin-bottom:10px}[mkz] .mkz-c-o__name-link{color:#333;text-decoration:none;cursor:pointer}[mkz] .mkz-c-o__name-link:hover{text-decoration:underline}[mkz] .mkz-c-o__info{margin-bottom:20px}[mkz] .mkz-c-o__info-price{font-weight:600;font-size:17px;line-height:22px}[mkz] .mkz-c-o__counter{font-size:10px;line-height:18px;padding:3px 10px;color:#787878}[mkz] .mkz-c-f__i:not(:last-child){margin-bottom:5px}[mkz] .mkz-c-f__link{display:inline-block;max-width:100%;border-radius:6px;position:relative}[mkz] .mkz-c-f__link,[mkz] .mkz-c-f__link:hover{text-decoration:none;color:#333}[mkz] .mkz-c-f__link:hover{box-shadow:0px 0px 6px rgba(120,120,120,0.25),0px 0px 1px rgba(120,120,120,0.1)}[mkz] .mkz-c-f__preview{position:absolute;left:0;top:0;bottom:0;width:40px;padding:6px 0;box-sizing:border-box;display:flex;justify-content:center;align-items:center;background-color:#f5f5f5;border-radius:6px 0 0 6px;z-index:1}[mkz] .mkz-c-f__content{min-height:48px;padding:6px 8px;margin-left:40px;box-sizing:border-box;display:flex;align-items:center;background-color:#DFDFDF;border-radius:0 6px 6px 0}[mkz] .mkz-c-f__text{display:block;width:100%}[mkz] .mkz-c-f__name,[mkz] .mkz-c-f__size{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}[mkz] .mkz-c-f__name{display:block;font-size:14px;line-height:20px}[mkz] .mkz-c-f__size{display:block;font-size:11px;line-height:16px;color:#828282}[mkz] .mkz-c-i{font-size:0;margin:0 -4px}[mkz] .mkz-c-i__i{display:inline-block;vertical-align:top;position:relative;height:136px}[mkz] .mkz-c-i__i:not(:last-child){margin-bottom:8px}[mkz] .mkz-c-i__i_type_0,[mkz] .mkz-c-i__i_type_1{width:50%}[mkz] .mkz-c-i__i_type_2{width:100%}[mkz] .mkz-c-i__link{position:absolute;left:4px;top:0;right:4px;bottom:0;background-position:center center;background-size:cover;background-repeat:no-repeat;border-radius:6px;cursor:pointer;background-color:#f5f5f5}[mkz] .mkz-c-i__link,[mkz] .mkz-c-i__link:hover{text-decoration:none}[mkz] .mkz-c-i__link:hover{box-shadow:0px 0px 6px rgba(120,120,120,0.25),0px 0px 1px rgba(120,120,120,0.1)}[mkz] .mkz-c-preview{position:absolute;left:0;top:0;bottom:0;right:0;z-index:10;background-color:#333;color:#fff;border-radius:6px}[mkz] .mkz-c-preview__btn{position:absolute;top:16px;width:32px;height:32px;cursor:pointer;display:flex;align-items:center;justify-content:center;user-select:none}[mkz] .mkz-c-preview__btn_type_close{right:16px}[mkz] .mkz-c-preview__btn_type_download{left:16px}[mkz] .mkz-c-preview__content{position:absolute;left:1px;top:79px;right:1px;bottom:73px;display:flex;align-items:center;justify-content:center}[mkz] .mkz-c-preview__img{display:block;max-width:100%;max-height:100%;border-radius:6px}[mkz] .mkz-c-preview__action{position:absolute;left:24px;right:24px;bottom:19px;font-size:14px;line-height:32px;display:flex;justify-content:space-between}[mkz] .mkz-c-preview__prev,[mkz] .mkz-c-preview__next{cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;background-color:#8D8D8D;border-radius:4px;user-select:none}.mkz-c-mobile.mkz-c-fixed{position:fixed !important;height:100% !important;width:100% !important;max-width:100% !important;overflow-x:hidden !important}.mkz-c-mobile.mkz-c-fixed body{z-index:auto !important;zoom:1 !important;max-width:100% !important;overflow-x:hidden !important}.mkz-c-mobile [mkz] .mkz-c__chat{max-height:none;max-width:none;width:auto;height:auto;right:0;left:0;top:0;bottom:0}.mkz-c-mobile [mkz] .mkz-c__input,.mkz-c-mobile [mkz] .mkz-f__input,.mkz-c-mobile [mkz] .mkz-f__select{font-size:16px}.mkz-c-mobile [mkz] .mkz-c__cart,.mkz-c-mobile [mkz] .mkz-c__chat_position_left .mkz-c__cart{right:0;left:0;top:0;bottom:0;border-style:none}.mkz-c-mobile [mkz] .mkz-c__cart,.mkz-c-mobile [mkz] .mkz-c__head,.mkz-c-mobile [mkz] .mkz-c__footer{border-radius:0}@keyframes mkzBounceAnim1{0%{transform:rotate(45deg) scale(1);rx:0}5%{transform:rotate(90deg) scale(1);rx:0}10%{transform:rotate(90deg) scale(0.5);rx:10}12%{transform:rotate(90deg) scale(0.5)}20%{transform:rotate(90deg) scale(0.5);rx:10}25%{transform:rotate(45deg) scale(1);rx:0}100%{transform:rotate(45deg) scale(1);rx:0}}@keyframes mkzBounceAnim2{10%{opacity:1;transform:scale(0.5) translate(0, 0)}12%{opacity:1;transform:scale(0.5) translate(-27px, 0)}17%{opacity:1;transform:scale(0.5) translate(-27px, 0)}20%{opacity:1;transform:scale(0.5) translate(0, 0)}25%{opacity:0;transform:scale(0.5) translate(0, 0)}}@keyframes mkzBounceAnim3{10%{opacity:1;transform:scale(0.5) translate(0, 0)}12%{opacity:1;transform:scale(0.5) translate(27px, 0)}17%{opacity:1;transform:scale(0.5) translate(27px, 0)}20%{opacity:1;transform:scale(0.5) translate(0, 0)}25%{opacity:0;transform:scale(0.5) translate(0, 0)}}@keyframes mkzBounceSmScale{94%{transform:scale(1)}98%{transform:scale(1.05)}100%{transform:scale(1)}}\n"},function(e,t,n){function i(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s,o=!0,a=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw s}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var s=n(12).Socket,o=n(6),a=n(8),l=n(14).default,c=n(7),h=n(33);e.exports={version:"1.5.2",airbrakeProject:254408,airbrakeApiKey:"84e2f7b3f257c5fffb9edf2d951f2054",store:{},libs:{},previewMode:!1,isMobile:!1,create:function(e,t){var n=this;t&&0!==Object.values(t).length&&(this.libs.notifierInstance?this.notifier=this.libs.notifierInstance(this.version,this.airbrakeProject,this.airbrakeApiKey,"production"):this.notifier=this.libs.notifier,this.notifier.call((function(){n.settings=t,n.locale=e,n.log("chat","created"),n.view=new l(n),c.init(n),n.libs.eEmit.subscribe("plugin.chat.update",(function(e){n.settings=e,n.view.render()})),n.libs.eEmit.subscribe("plugin.chat.show",n.view.showChat.bind(n.view)),n.libs.eEmit.subscribe("plugin.chat.hide",n.view.hideChat.bind(n.view)),n.isMobile=n.libs.helpers.isMobile(),n.createConnection(),n.urlBind()})))},destroy:function(){this.view&&this.view.destroy(),this.socket&&this.socket.disconnect()},preview:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.previewMode=!0,this.isMobile=Boolean(n.isMobile),this.settings=t,this.locale=e,this.view=new l(this),this.view.history=n.history||[],this.view.width=n.width||null,this.view.render(),this.view.visibleChat(),n.collapsed?this.view.showNotice():this.view.showChat(),n.currentAgent&&(this.currentAgent=n.currentAgent,this.view.assignAgent(),this.updateAgentState())},currentAgent:null,agents:[],agentIsOnline:!1,sessionsCount:0,settings:{},locale:null,log:function(){var e;this.libs.log&&(e=this.libs.log).push.apply(e,["chat"].concat(Array.prototype.slice.call(arguments)))},urlBind:function(){decodeURIComponent(window.location.search).indexOf("mkz-chat=open")>-1&&this.view.showChat()},createConnection:function(){var e=this;this.notifier.call((function(){e.view.render(),e.socket=new s("".concat(e.store.chatProtocol||"wss://").concat(e.store.chatEndpoint,"/socket")),e.socket.onOpen(e.handlerConnected.bind(e)),e.socket.onClose(e.handlerDisconnected.bind(e)),e.socket.connect(),e.servicChannel=e.socket.channel("chat-client:".concat(e.store.appKey)),e.servicChannel.join().receive("error",(function(){return e.handlerFailJoined.bind(e,e.servicChannel.topic)})),e.servicChannel.on("agent:entered",e.handlerAgentStatus.bind(e,!0)),e.servicChannel.on("agent:exited",e.handlerAgentStatus.bind(e,!1)),e.clientChannel=e.socket.channel("room:".concat(e.store.appKey,":").concat(e.store.uid)),e.clientChannel.join().receive("ok",e.handlerJoined.bind(e)).receive("error",e.handlerFailJoined.bind(e,e.clientChannel.topic)),e.clientChannel.on("client:entered",e.handlerClientEntered.bind(e)),e.clientChannel.on("message:new",e.handlerMsg.bind(e)),e.clientChannel.on("message:resend",e.handlerMsgResend.bind(e)),e.clientChannel.on("agent:assign",e.handlerAgentAssign.bind(e)),e.clientChannel.on("survey:show",e.handlerSurveyShow.bind(e)),e.clientChannel.on("event:survey_submitted",e.handlerSurveySubmitted.bind(e))}))},handlerConnected:function(){var e=this;this.notifier.call((function(){e.view.connected()}))},handlerDisconnected:function(){var e=this;this.notifier.call((function(){e.view.disconnected()}))},handlerJoined:function(){var e=this;this.notifier.call((function(){e.view.visibleChat(),e.view.scrollBottom(),e.view.enableSending(),e.log("chat","joined")}))},handlerFailJoined:function(e){console.warn("Cannot join channel ".concat(e))},handlerAgentStatus:function(e,t){var n=this,i=t.agent_id;this.notifier.call((function(){var t=n.getAgent(i);t&&(t.isOnline=e,n.currentAgent&&n.currentAgent.agent_id===i&&(n.currentAgent.isOnline=e),n.updateAgentState())}))},handlerClientEntered:function(e){var t=this;this.notifier.call((function(){t.setAgents(e.agents),t.sessionsCount=e.sessionsCount,t.setCurrentAgent(e.current_agent_id),t.updateAgentState(),t.libs.eEmit&&t.libs.eEmit.emit("plugin.chat.channel.entered"),t.log("chat","ClientEntered",e)}))},handlerSurveyShow:function(e){var t=this;this.notifier.call((function(){t.view.windowFocus&&h.trackShow(e.custom_fields.uid),t.handlerMsg(e)}))},handlerMsg:function(e){var t=this;this.notifier.call((function(){e=t.addMsg(e),t.stateChangeMsg(e),t.view.scrollBottom(),t.log("chat","Msg",e)}))},handlerMsgResend:function(e){var t=this;this.notifier.call((function(){e=t.addMsg(e),t.stateChangeMsg(e),t.view.scrollBottom(),t.setCurrentAgent(e.current_agent_id),t.log("chat","Resend",e)}))},handlerAgentAssign:function(e){var t=this;this.notifier.call((function(){t.setCurrentAgent(e.target_agent_id)}))},handlerCollapse:function(e){var t=this;this.notifier.call((function(){if(!0!==e){var n,r=a.getList(),s=i(r);try{for(s.s();!(n=s.n()).done;){var o=n.value;t.pusherMsgState(o,"read")}}catch(e){s.e(e)}finally{s.f()}r.length>0&&(a.resetList(),t.view.renderUnread())}}))},handlerSurveySubmitted:function(e){var t=this;this.notifier.call((function(){var n=o.findMsg(e.custom_fields.muid);n&&(n.custom_fields.submitted=!0,o.addMsg(n),t.view.renderMessage(n),o.batchUpdateMsg((function(e){return e.muid!==n.muid&&"survey:show"===e.msg_type&&e.custom_fields.uid===n.custom_fields.uid}),(function(e){return e.custom_fields=n.custom_fields})).map((function(e){return t.view.renderMessage(e)})))}))},pusherTyping:function(e){if(e)return this.clientChannel.push("client:activity",{type:"typing",text:e})},pusherNewMsg:function(e){if(e){var t=+new Date,n=this.store.uid,i={muid:"".concat(n,":c:").concat(t),text:e,status:"sent",sent_at:this.getDateTime()},r=o.getHistory(),s=r.length>0&&r[r.length-1];return s&&"message:auto"===s.msg_type&&(i.prev_auto_message=Object.assign({},s,{auto_message_uid:s.auto_message_uid,status:"read",device_uid:n,custom_fields:{}}),delete i.prev_auto_message.exclude,c.trackReply(s.muid)),this.clientChannel.push("message:new",i)}},pusherMsgState:function(e,t){e&&this.clientChannel.push("message:status:change",{muid:e,new_status:t,sent_at:this.getDateTime()})},pusherNewSurveyMsg:function(e,t){var n=o.findMsg(e);n&&(this.clientChannel.push("survey:submit",{muid:e,title:n.custom_fields.title}),h.trackSubmit(n.custom_fields.uid,t))},getDateTime:function(){return(new Date).toISOString().replace("Z","000Z")},stateChangeMsg:function(e){null!==e.agent_id&&(!1===this.view.collapsed?this.pusherMsgState(e.muid,"read"):(this.pusherMsgState(e.muid,"delivered"),a.addItem(e.muid),this.view.renderUnread()))},addMsg:function(e){if(null!==e.agent_id){var t=this.getAgent(e.agent_id);t&&(e.sender_avatar_url=t.avatar_url||t.sender_avatar_url,e.sender_name=t.name||e.sender_name),this.view.notifyNewMsg(e),!0===this.view.collapsed&&this.view.showBeacon(!0)}o.addMsg(e);var n=o.getNextMsg(e.muid);return this.view.renderMessage(e,n),e},setCurrentAgent:function(e){if(!e&&!this.currentAgent){var t=Object.values(this.agents).find((function(e){return e.isOnline}));e=t?t.id:Object.values(this.agents)[0].id}this.currentAgent=this.getAgent(e),this.currentAgent?this.view.assignAgent():this.view.unassignAgent(),this.updateAgentState()},setAgents:function(e){this.agents=e.reduce((function(e,t){return e[t.id]=t,e}),{})},getAgent:function(e){return this.agents[e]||null},updateAgentState:function(){this.currentAgent?this.agentIsOnline=this.currentAgent.isOnline:this.agentIsOnline=Object.values(this.agents).find((function(e){return e.isOnline}))&&!0,this.view.renderAgentState()}}},function(e,t,n){"use strict";n.r(t);var i=n(10);mkz("initPlugin","chat",n.n(i).a)},function(e,t,n){"use strict";n.r(t),n.d(t,"Channel",(function(){return C})),n.d(t,"Serializer",(function(){return S})),n.d(t,"Socket",(function(){return M})),n.d(t,"LongPoll",(function(){return T})),n.d(t,"Ajax",(function(){return j})),n.d(t,"Presence",(function(){return A}));const i="undefined"!=typeof self?self:null,r="undefined"!=typeof window?window:null,s=i||r||void 0,o=0,a=1,l=2,c=3,h="closed",u="errored",d="joined",m="joining",p="leaving",f="phx_close",_="phx_error",g="phx_join",k="phx_reply",b="phx_leave",v=[f,_,g,k,b],z="longpoll",y="websocket";let x=e=>{if("function"==typeof e)return e;return function(){return e}};class w{constructor(e,t,n,i){this.channel=e,this.event=t,this.payload=n||function(){return{}},this.receivedResp=null,this.timeout=i,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}resend(e){this.timeout=e,this.reset(),this.send()}send(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload(),ref:this.ref,join_ref:this.channel.joinRef()}))}receive(e,t){return this.hasReceived(e)&&t(this.receivedResp.response),this.recHooks.push({status:e,callback:t}),this}reset(){this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1}matchReceive({status:e,response:t,ref:n}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}cancelRefEvent(){this.refEvent&&this.channel.off(this.refEvent)}cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}startTimeout(){this.timeoutTimer&&this.cancelTimeout(),this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,e=>{this.cancelRefEvent(),this.cancelTimeout(),this.receivedResp=e,this.matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}trigger(e,t){this.channel.trigger(this.refEvent,{status:e,response:t})}}class C{constructor(e,t,n){this.state=h,this.topic=e,this.params=x(t||{}),this.socket=n,this.bindings=[],this.bindingRef=0,this.timeout=this.socket.timeout,this.joinedOnce=!1,this.joinPush=new w(this,g,this.params,this.timeout),this.pushBuffer=[],this.stateChangeRefs=[],this.rejoinTimer=new E(()=>{this.socket.isConnected()&&this.rejoin()},this.socket.rejoinAfterMs),this.stateChangeRefs.push(this.socket.onError(()=>this.rejoinTimer.reset())),this.stateChangeRefs.push(this.socket.onOpen(()=>{this.rejoinTimer.reset(),this.isErrored()&&this.rejoin()})),this.joinPush.receive("ok",()=>{this.state=d,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this.joinPush.receive("error",()=>{this.state=u,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.hasLogger()&&this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=h,this.socket.remove(this)}),this.onError(e=>{this.socket.hasLogger()&&this.socket.log("channel","error "+this.topic,e),this.isJoining()&&this.joinPush.reset(),this.state=u,this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.joinPush.receive("timeout",()=>{this.socket.hasLogger()&&this.socket.log("channel",`timeout ${this.topic} (${this.joinRef()})`,this.joinPush.timeout),new w(this,b,x({}),this.timeout).send(),this.state=u,this.joinPush.reset(),this.socket.isConnected()&&this.rejoinTimer.scheduleTimeout()}),this.on(k,(e,t)=>{this.trigger(this.replyEventName(t),e)})}join(e=this.timeout){if(this.joinedOnce)throw new Error("tried to join multiple times. 'join' can only be called a single time per channel instance");return this.timeout=e,this.joinedOnce=!0,this.rejoin(),this.joinPush}onClose(e){this.on(f,e)}onError(e){return this.on(_,t=>e(t))}on(e,t){let n=this.bindingRef++;return this.bindings.push({event:e,ref:n,callback:t}),n}off(e,t){this.bindings=this.bindings.filter(n=>!(n.event===e&&(void 0===t||t===n.ref)))}canPush(){return this.socket.isConnected()&&this.isJoined()}push(e,t,n=this.timeout){if(!this.joinedOnce)throw new Error(`tried to push '${e}' to '${this.topic}' before joining. Use channel.join() before pushing events`);let i=new w(this,e,(function(){return t}),n);return this.canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}leave(e=this.timeout){this.rejoinTimer.reset(),this.joinPush.cancelTimeout(),this.state=p;let t=()=>{this.socket.hasLogger()&&this.socket.log("channel","leave "+this.topic),this.trigger(f,"leave")},n=new w(this,b,x({}),e);return n.receive("ok",()=>t()).receive("timeout",()=>t()),n.send(),this.canPush()||n.trigger("ok",{}),n}onMessage(e,t,n){return t}isLifecycleEvent(e){return v.indexOf(e)>=0}isMember(e,t,n,i){return this.topic===e&&(!i||i===this.joinRef()||!this.isLifecycleEvent(t)||(this.socket.hasLogger()&&this.socket.log("channel","dropping outdated message",{topic:e,event:t,payload:n,joinRef:i}),!1))}joinRef(){return this.joinPush.ref}sendJoin(e){this.state=m,this.joinPush.resend(e)}rejoin(e=this.timeout){this.isLeaving()||this.sendJoin(e)}trigger(e,t,n,i){let r=this.onMessage(e,t,n,i);if(t&&!r)throw new Error("channel onMessage callbacks must return the payload, modified or unmodified");for(let t=0;t<this.bindings.length;t++){const s=this.bindings[t];s.event===e&&s.callback(r,n,i||this.joinRef())}}replyEventName(e){return"chan_reply_"+e}isClosed(){return this.state===h}isErrored(){return this.state===u}isJoined(){return this.state===d}isJoining(){return this.state===m}isLeaving(){return this.state===p}}let S={encode(e,t){let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))},decode(e,t){let[n,i,r,s,o]=JSON.parse(e);return t({join_ref:n,ref:i,topic:r,event:s,payload:o})}};class M{constructor(e,t={}){this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=t.timeout||1e4,this.transport=t.transport||s.WebSocket||T,this.defaultEncoder=S.encode,this.defaultDecoder=S.decode,this.closeWasClean=!1,this.unloaded=!1,this.binaryType=t.binaryType||"arraybuffer",this.transport!==T?(this.encode=t.encode||this.defaultEncoder,this.decode=t.decode||this.defaultDecoder):(this.encode=this.defaultEncoder,this.decode=this.defaultDecoder),r&&r.addEventListener&&r.addEventListener("beforeunload",e=>{this.conn&&(this.unloaded=!0,this.abnormalClose("unloaded"))}),this.heartbeatIntervalMs=t.heartbeatIntervalMs||3e4,this.rejoinAfterMs=e=>t.rejoinAfterMs?t.rejoinAfterMs(e):[1e3,2e3,5e3][e-1]||1e4,this.reconnectAfterMs=e=>this.unloaded?100:t.reconnectAfterMs?t.reconnectAfterMs(e):[10,50,100,150,200,250,500,1e3,2e3][e-1]||5e3,this.logger=t.logger||null,this.longpollerTimeout=t.longpollerTimeout||2e4,this.params=x(t.params||{}),this.endPoint=`${e}/${y}`,this.vsn=t.vsn||"2.0.0",this.heartbeatTimer=null,this.pendingHeartbeatRef=null,this.reconnectTimer=new E(()=>{this.teardown(()=>this.connect())},this.reconnectAfterMs)}protocol(){return location.protocol.match(/^https/)?"wss":"ws"}endPointURL(){let e=j.appendParams(j.appendParams(this.endPoint,this.params()),{vsn:this.vsn});return"/"!==e.charAt(0)?e:"/"===e.charAt(1)?`${this.protocol()}:${e}`:`${this.protocol()}://${location.host}${e}`}disconnect(e,t,n){this.closeWasClean=!0,this.reconnectTimer.reset(),this.teardown(e,t,n)}connect(e){e&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=x(e)),this.conn||(this.closeWasClean=!1,this.conn=new this.transport(this.endPointURL()),this.conn.binaryType=this.binaryType,this.conn.timeout=this.longpollerTimeout,this.conn.onopen=()=>this.onConnOpen(),this.conn.onerror=e=>this.onConnError(e),this.conn.onmessage=e=>this.onConnMessage(e),this.conn.onclose=e=>this.onConnClose(e))}log(e,t,n){this.logger(e,t,n)}hasLogger(){return null!==this.logger}onOpen(e){let t=this.makeRef();return this.stateChangeCallbacks.open.push([t,e]),t}onClose(e){let t=this.makeRef();return this.stateChangeCallbacks.close.push([t,e]),t}onError(e){let t=this.makeRef();return this.stateChangeCallbacks.error.push([t,e]),t}onMessage(e){let t=this.makeRef();return this.stateChangeCallbacks.message.push([t,e]),t}onConnOpen(){this.hasLogger()&&this.log("transport","connected to "+this.endPointURL()),this.unloaded=!1,this.closeWasClean=!1,this.flushSendBuffer(),this.reconnectTimer.reset(),this.resetHeartbeat(),this.stateChangeCallbacks.open.forEach(([,e])=>e())}resetHeartbeat(){this.conn&&this.conn.skipHeartbeat||(this.pendingHeartbeatRef=null,clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs))}teardown(e,t,n){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,n||""):this.conn.close(),this.conn=null),e&&e()}onConnClose(e){this.hasLogger()&&this.log("transport","close",e),this.triggerChanError(),clearInterval(this.heartbeatTimer),this.closeWasClean||this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(([,t])=>t(e))}onConnError(e){this.hasLogger()&&this.log("transport",e),this.triggerChanError(),this.stateChangeCallbacks.error.forEach(([,t])=>t(e))}triggerChanError(){this.channels.forEach(e=>{e.isErrored()||e.isLeaving()||e.isClosed()||e.trigger(_)})}connectionState(){switch(this.conn&&this.conn.readyState){case o:return"connecting";case a:return"open";case l:return"closing";default:return"closed"}}isConnected(){return"open"===this.connectionState()}remove(e){this.off(e.stateChangeRefs),this.channels=this.channels.filter(t=>t.joinRef()!==e.joinRef())}off(e){for(let t in this.stateChangeCallbacks)this.stateChangeCallbacks[t]=this.stateChangeCallbacks[t].filter(([t])=>!e.includes(t))}channel(e,t={}){let n=new C(e,t,this);return this.channels.push(n),n}push(e){if(this.hasLogger()){let{topic:t,event:n,payload:i,ref:r,join_ref:s}=e;this.log("push",`${t} ${n} (${s}, ${r})`,i)}this.isConnected()?this.encode(e,e=>this.conn.send(e)):this.sendBuffer.push(()=>this.encode(e,e=>this.conn.send(e)))}makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}sendHeartbeat(){if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.hasLogger()&&this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void this.abnormalClose("heartbeat timeout");this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef})}}abnormalClose(e){this.closeWasClean=!1,this.conn.close(1e3,e)}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}onConnMessage(e){this.decode(e.data,e=>{let{topic:t,event:n,payload:i,ref:r,join_ref:s}=e;r&&r===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.hasLogger()&&this.log("receive",`${i.status||""} ${t} ${n} ${r&&"("+r+")"||""}`,i);for(let e=0;e<this.channels.length;e++){const o=this.channels[e];o.isMember(t,n,i,s)&&o.trigger(n,i,r,s)}for(let t=0;t<this.stateChangeCallbacks.message.length;t++){let[,n]=this.stateChangeCallbacks.message[t];n(e)}})}}class T{constructor(e){this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(e),this.readyState=o,this.poll()}normalizeEndpoint(e){return e.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+y),"$1/"+z)}endpointURL(){return j.appendParams(this.pollEndpoint,{token:this.token})}closeAndRetry(){this.close(),this.readyState=o}ontimeout(){this.onerror("timeout"),this.closeAndRetry()}poll(){this.readyState!==a&&this.readyState!==o||j.request("GET",this.endpointURL(),"application/json",null,this.timeout,this.ontimeout.bind(this),e=>{if(e){var{status:t,token:n,messages:i}=e;this.token=n}else var t=0;switch(t){case 200:i.forEach(e=>this.onmessage({data:e})),this.poll();break;case 204:this.poll();break;case 410:this.readyState=a,this.onopen(),this.poll();break;case 0:case 500:this.onerror(),this.closeAndRetry();break;default:throw new Error("unhandled poll status "+t)}})}send(e){j.request("POST",this.endpointURL(),"application/json",e,this.timeout,this.onerror.bind(this,"timeout"),e=>{e&&200===e.status||(this.onerror(e&&e.status),this.closeAndRetry())})}close(e,t){this.readyState=c,this.onclose()}}class j{static request(e,t,n,i,r,o,a){if(s.XDomainRequest){let n=new XDomainRequest;this.xdomainRequest(n,e,t,i,r,o,a)}else{let l=s.XMLHttpRequest?new s.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.xhrRequest(l,e,t,n,i,r,o,a)}}static xdomainRequest(e,t,n,i,r,s,o){e.timeout=r,e.open(t,n),e.onload=()=>{let t=this.parseJSON(e.responseText);o&&o(t)},s&&(e.ontimeout=s),e.onprogress=()=>{},e.send(i)}static xhrRequest(e,t,n,i,r,s,o,a){e.open(t,n,!0),e.timeout=s,e.setRequestHeader("Content-Type",i),e.onerror=()=>{a&&a(null)},e.onreadystatechange=()=>{if(e.readyState===this.states.complete&&a){let t=this.parseJSON(e.responseText);a(t)}},o&&(e.ontimeout=o),e.send(r)}static parseJSON(e){if(!e||""===e)return null;try{return JSON.parse(e)}catch(t){return console&&console.log("failed to parse JSON response",e),null}}static serialize(e,t){let n=[];for(var i in e){if(!e.hasOwnProperty(i))continue;let r=t?`${t}[${i}]`:i,s=e[i];"object"==typeof s?n.push(this.serialize(s,r)):n.push(encodeURIComponent(r)+"="+encodeURIComponent(s))}return n.join("&")}static appendParams(e,t){if(0===Object.keys(t).length)return e;let n=e.match(/\?/)?"&":"?";return`${e}${n}${this.serialize(t)}`}}j.states={complete:4};class A{constructor(e,t={}){let n=t.events||{state:"presence_state",diff:"presence_diff"};this.state={},this.pendingDiffs=[],this.channel=e,this.joinRef=null,this.caller={onJoin:function(){},onLeave:function(){},onSync:function(){}},this.channel.on(n.state,e=>{let{onJoin:t,onLeave:n,onSync:i}=this.caller;this.joinRef=this.channel.joinRef(),this.state=A.syncState(this.state,e,t,n),this.pendingDiffs.forEach(e=>{this.state=A.syncDiff(this.state,e,t,n)}),this.pendingDiffs=[],i()}),this.channel.on(n.diff,e=>{let{onJoin:t,onLeave:n,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=A.syncDiff(this.state,e,t,n),i())})}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}list(e){return A.list(this.state,e)}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel.joinRef()}static syncState(e,t,n,i){let r=this.clone(e),s={},o={};return this.map(r,(e,n)=>{t[e]||(o[e]=n)}),this.map(t,(e,t)=>{let n=r[e];if(n){let i=t.metas.map(e=>e.phx_ref),r=n.metas.map(e=>e.phx_ref),a=t.metas.filter(e=>r.indexOf(e.phx_ref)<0),l=n.metas.filter(e=>i.indexOf(e.phx_ref)<0);a.length>0&&(s[e]=t,s[e].metas=a),l.length>0&&(o[e]=this.clone(n),o[e].metas=l)}else s[e]=t}),this.syncDiff(r,{joins:s,leaves:o},n,i)}static syncDiff(e,{joins:t,leaves:n},i,r){let s=this.clone(e);return i||(i=function(){}),r||(r=function(){}),this.map(t,(e,t)=>{let n=s[e];if(s[e]=t,n){let t=s[e].metas.map(e=>e.phx_ref),i=n.metas.filter(e=>t.indexOf(e.phx_ref)<0);s[e].metas.unshift(...i)}i(e,n,t)}),this.map(n,(e,t)=>{let n=s[e];if(!n)return;let i=t.metas.map(e=>e.phx_ref);n.metas=n.metas.filter(e=>i.indexOf(e.phx_ref)<0),r(e,n,t),0===n.metas.length&&delete s[e]}),s}static list(e,t){return t||(t=function(e,t){return t}),this.map(e,(e,n)=>t(e,n))}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static clone(e){return JSON.parse(JSON.stringify(e))}}class E{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=null,this.tries=0}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}},function(e,t){function n(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s,o=!0,a=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}e.exports={name:"mkz_c_auto_msg_history",addItems:function(e){var t,i=this.getItems(),r=n(e);try{var s=function(){var e=t.value,n=i.findIndex((function(t){return t.payload.custom_fields.uid===e.payload.custom_fields.uid}));-1===n?i.push(e):i[n].payload.custom_fields=e.payload.custom_fields};for(r.s();!(t=r.n()).done;)s()}catch(e){r.e(e)}finally{r.f()}return this.setItems(i),i},getItems:function(){var e=sessionStorage.getItem(this.name),t=[];try{t=JSON.parse(e)||[]}catch(e){}return t},setItems:function(e){return sessionStorage.setItem(this.name,JSON.stringify(e)),e},removeItem:function(e){var t=this.getItems(),n=t.findIndex((function(t){return t.payload.muid===e}));return-1!==n&&(t.splice(n,1),this.setItems(t)),t}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return View}));var _babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2__);function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r,s=!0,o=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,r=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var css=__webpack_require__(9),msgDelivered=__webpack_require__(8),helpers=__webpack_require__(3),domEvent=__webpack_require__(4),_require=__webpack_require__(26),startBlink=_require.startBlink,stopBlink=_require.stopBlink,Template=__webpack_require__(27).default,msgStory=__webpack_require__(6),translations=__webpack_require__(5),Sound=__webpack_require__(29).default,mute=__webpack_require__(30),ImagePreview=__webpack_require__(31).default,View=function(){function View(e){_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_1___default()(this,View),this.history=null,this.collapsed="true"!==helpers.getUrlParameter("mkz_expand_chat"),this.oldCollapsed=!0,this.windowFocus=!0,this.app=e,this.previewMode=e.previewMode,this.libs=e.libs,this.allowSending=!1,this.typingTimeout=1e3,this.noticeShowTimeout=1e3,this.noticeHideTimeout=1e4,this.width=null,this.focusOnHistory=!1,this.template=new Template(this),this.containerBeaconClassName="mkz-c_beacon_show",this.containerChatClassName="mkz-c_chat_show",this.containerValidMessageClassName="mkz-c_valid-message_yes",this.htmlClassName="mkz-c-fixed",this.mobileClassName="mkz-c-mobile",this.defaultAvatarUrl="https://assets-shared.markeaze.com/public/avatars/mini_logo.png",this.validationOptions={invalidClassName:"mkz-f__invalid",invalidParentClassName:"mkz-f__invalid-wrap"},this.sound=new Sound(e.settings.appearance.client_sound_path)}return _babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_2___default()(View,[{key:"destroy",value:function(){this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},{key:"bind",value:function(){var e=this;domEvent.add(this.elInput,"keyup",this.renderForm.bind(this)),domEvent.add(this.elInput,"cut",this.renderForm.bind(this)),domEvent.add(this.elInput,"paste",this.renderForm.bind(this)),domEvent.add(this.elToggle,"click",this.showChat.bind(this)),domEvent.add(this.elClose,"click",this.hideChat.bind(this)),domEvent.add(this.elScroll,"mouseenter",(function(){e.focusOnHistory=!0})),domEvent.add(this.elScroll,"mouseleave",(function(){e.focusOnHistory=!1})),this.previewMode||(domEvent.add(window,"focus",this.onFocus.bind(this)),domEvent.add(window,"blur",this.onBlur.bind(this)),domEvent.add(window,"resize",this.setZoom.bind(this)),domEvent.add(this.elSubmit,"click",this.sendMsg.bind(this)),domEvent.add(this.elInput,"keydown",(function(t){13!=t.keyCode||t.shiftKey?e.startTyping():(t.preventDefault(),e.sendMsg())})),mute.bind(this))}},{key:"bindMessage",value:function(e){var t=this;if(!this.previewMode){var n,i=_createForOfIteratorHelper(e.querySelectorAll(".mkz-c-o-js-action"));try{for(i.s();!(n=i.n()).done;){var r=n.value;domEvent.add(r,"click",this.clickProductAttachment.bind(this))}}catch(e){i.e(e)}finally{i.f()}var s,o=_createForOfIteratorHelper(e.querySelectorAll(".mkz-f-js"));try{for(o.s();!(s=o.n()).done;){var a=s.value;domEvent.add(a,"submit",this.submitSurveyForm.bind(this))}}catch(e){o.e(e)}finally{o.f()}var l,c=e.querySelectorAll(".mkz-c-i-js"),h=_createForOfIteratorHelper(c);try{var u=function(){var e=l.value;domEvent.add(e,"click",(function(n){return t.renderPreviewImages(n,e,c)}))};for(h.s();!(l=h.n()).done;)u()}catch(e){h.e(e)}finally{h.f()}}}},{key:"renderPreviewImages",value:function(e,t,n){e.preventDefault();var i=Array.prototype.indexOf.call(n,t);new ImagePreview(this,i,n)}},{key:"renderForm",value:function(){var e=this;setTimeout((function(){e.setMsgHeight(),e.renderFormValidate()}),0)}},{key:"renderFormValidate",value:function(){this.elInput.value.length>0?helpers.addClass(this.elContainer,this.containerValidMessageClassName):helpers.removeClass(this.elContainer,this.containerValidMessageClassName)}},{key:"setZoom",value:function(){if(window.self===window.top&&this.app.isMobile){var e=helpers.getScale();this.elContainer.style.zoom=e>1?e:1}}},{key:"submitSurveyForm",value:function(e){e.preventDefault();var t=e.target,n=new this.libs.Validation(t,this.validationOptions).valid(),i=t.dataset.uid;if(n){var r=new this.libs.FormToObject(t),s=msgStory.findMsg(i);if(s&&(s.custom_fields.elements.map((function(e){e.value=r[e.field]||""})),msgStory.addMsg(s)),s&&s.custom_fields){var o=s.custom_fields.elements;r=Object.entries(r).reduce((function(e,t){var n=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default()(t,2),i=n[0],r=n[1];e[i]=r;var s=o.find((function(e){return e.field===i}));if(s)switch(s.display_type){case"boolean":"true"===r&&(e[i]=!0),"false"===r&&(e[i]=!1);break;case"numeric":""!==r&&(e[i]=parseFloat(r));break;case"integer":""!==r&&(e[i]=parseInt(r))}return e}),{})}r=Object.entries(r).reduce((function(e,t){var n=_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_0___default()(t,2),i=n[0],r=n[1];return 0===i.indexOf("properties.")?(e.properties=e.properties||{},e.properties[i.replace("properties.","")]=r):e[i]=r,e}),{}),this.app.pusherNewSurveyMsg(i,r),t.querySelector("button").disabled=!0}}},{key:"clickProductAttachment",value:function clickProductAttachment(e){var el=e.target,offer=JSON.parse(el.dataset.data),callbackLabel=el.dataset.callback_label,settings=this.app.settings.behavior.attachment_cta.product,callback=function callback(){callbackLabel&&(el.innerHTML=callbackLabel),settings.callback&&eval(settings.callback)(offer)};el.handlerDone||(el.handlerDone=!0,el.setAttribute("disabled",!0),eval(settings.handler)(offer,callback))}},{key:"onFocus",value:function(){this.windowFocus=!0,stopBlink()}},{key:"onBlur",value:function(){this.windowFocus=!1}},{key:"showChat",value:function(){"disabled"!==this.app.settings.beaconState&&(this.collapsed=!1,this.renderChatToggle())}},{key:"hideChat",value:function(){this.collapsed=!0,this.renderChatToggle()}},{key:"notifyNewMsg",value:function(e){"disabled"!==this.app.settings.beaconState&&(this.windowFocus||startBlink(translations[this.app.locale].new_message),mute.getState()||!this.collapsed&&this.windowFocus||this.sound.play())}},{key:"renderChatToggle",value:function(){var e=this,t=this.collapsed!==this.oldCollapsed;this.oldCollapsed=this.collapsed,this.collapsed?(helpers.removeClass(document.documentElement,this.htmlClassName),helpers.removeClass(this.elContainer,this.containerChatClassName),this.showBeacon()):(helpers.addClass(document.documentElement,this.htmlClassName),helpers.addClass(this.elContainer,this.containerChatClassName),this.hideBeacon()),!this.previewMode&&t&&(this.app.handlerCollapse(this.collapsed),this.collapsed||setTimeout((function(){e.elInput.focus()}),100))}},{key:"showBeacon",value:function(e){return"disabled"===this.app.settings.beaconState?this.hideBeacon():"hidden"!==this.app.settings.beaconState||e?void helpers.addClass(this.elContainer,this.containerBeaconClassName):this.hideBeacon()}},{key:"hideBeacon",value:function(){helpers.removeClass(this.elContainer,this.containerBeaconClassName)}},{key:"connected",value:function(){this.enableSending()}},{key:"disconnected",value:function(){this.disableSending()}},{key:"startTyping",value:function(){var e=this;this.timeoutTyping||(this.timeoutTyping=setTimeout((function(){e.sendTyping(),e.stopTyping()}),this.typingTimeout))}},{key:"stopTyping",value:function(){clearTimeout(this.timeoutTyping),this.timeoutTyping=null}},{key:"sendTyping",value:function(){var e=this.elInput.value;this.app.pusherTyping(e)}},{key:"sendMsg",value:function(){var e=this;if(this.allowSending){var t=this.elInput.value.trim();t&&(this.stopTyping(),this.disableSending(),this.app.pusherNewMsg(t).receive("ok",(function(){e.elInput.value=null,e.renderFormValidate(),e.setMsgHeight(),e.enableSending()})).receive("error",(function(){return e.enableSending.bind(e)})).receive("timeout",(function(){return e.enableSending.bind(e)})))}}},{key:"setMsgHeight",value:function(){this.elInput.style.height="auto";var e=this.elInput.scrollHeight;this.elInput.style.height=e+"px"}},{key:"disableSending",value:function(){this.allowSending=!1,this.elSubmit&&helpers.addClass(this.elSubmit,"mkz-c__submit_disabled_yes")}},{key:"enableSending",value:function(){this.allowSending=!0,this.elSubmit&&helpers.removeClass(this.elSubmit,"mkz-c__submit_disabled_yes")}},{key:"visibleChat",value:function(){helpers.addClass(this.elContainer,"mkz-c_display_yes")}},{key:"assignAgent",value:function(){if(this.elAgentName.innerText=this.app.currentAgent.name||"",this.app.settings.appearance.agent_post&&(this.elAgentPost.innerText=this.app.currentAgent.job_title||""),this.app.settings.appearance.agent_avatar){var e=this.app.currentAgent.avatar_url||this.defaultAvatarUrl;this.elAgentAvatar.src=e,this.elAgentAvatar.setAttribute("srcset",helpers.srcset(e)),this.elAgentAvatar.style.display="block"}else this.elAgentAvatar.style.display="none";helpers.addClass(this.elContainer,"mkz-c_agent_assign")}},{key:"unassignAgent",value:function(){helpers.removeClass(this.elContainer,"mkz-c_agent_assign")}},{key:"onlineAgents",value:function(){helpers.addClass(this.elContainer,"mkz-c_agent_online")}},{key:"offlineAgents",value:function(){helpers.removeClass(this.elContainer,"mkz-c_agent_online")}},{key:"toggleNotice",value:function(){var e=this;if(!this.previewMode){sessionStorage.getItem("mkz_c_tooltip_hidden")||(sessionStorage.setItem("mkz_c_tooltip_hidden",!0),setTimeout((function(){e.showNotice()}),this.noticeShowTimeout),setTimeout((function(){e.hideNotice()}),this.noticeShowTimeout+this.noticeHideTimeout))}}},{key:"showNotice",value:function(){helpers.addClass(this.elContainer,"mkz-c_tooltip_yes")}},{key:"hideNotice",value:function(){helpers.removeClass(this.elContainer,"mkz-c_tooltip_yes")}},{key:"render",value:function(){this.el||(this.el=helpers.appendHTML(document.body,this.template.content()),this.elContainer=this.el.querySelector(".mkz-c-js"),this.elCart=this.el.querySelector(".mkz-c-js-cart"),this.elInput=this.el.querySelector(".mkz-c-js-input"),this.elSubmit=this.el.querySelector(".mkz-c-js-submit"),this.elUnread=this.el.querySelector(".mkz-c-js-unread"),this.elClose=this.el.querySelector(".mkz-c-js-close"),this.elToggle=this.el.querySelector(".mkz-c-js-toggle"),this.elHistory=this.el.querySelector(".mkz-c-js-history"),this.elScroll=this.el.querySelector(".mkz-c-js-scroll"),this.elAgentName=this.el.querySelector(".mkz-c-js-agent-name"),this.elAgentPost=this.el.querySelector(".mkz-c-js-agent-post"),this.elAgentAvatar=this.el.querySelector(".mkz-c-js-agent-avatar"),this.bind(),this.showBeacon(),this.toggleNotice(),this.renderMessages(),this.previewMode||this.setZoom(),this.app.isMobile?helpers.addClass(document.documentElement,this.mobileClassName):helpers.removeClass(document.documentElement,this.mobileClassName)),this.renderChatToggle(),this.renderUnread()}},{key:"renderMessages",value:function(){var e,t=_createForOfIteratorHelper(this.history||msgStory.getHistory());try{for(t.s();!(e=t.n()).done;){var n=e.value;this.renderMessage(n)}}catch(e){t.e(e)}finally{t.f()}}},{key:"renderMessage",value:function(e,t){var n=this.template.message(e),i=this.findMsg(e.muid);if(i)i.innerHTML=n;else{var r=t&&this.findMsg(t.muid);i=r?helpers.beforeHTML(r,n):helpers.appendHTML(this.elHistory,n)}this.bindMessage(i)}},{key:"findMsg",value:function(e){return this.elHistory.querySelector('[data-id="'.concat(e,'"]'))}},{key:"renderUnread",value:function(){if(this.elUnread){var e=msgDelivered.getList().length;this.elUnread.innerHTML=e,this.elUnread.style.display=0===e?"none":"block"}}},{key:"renderAgentState",value:function(){this.app.agentIsOnline?this.onlineAgents():this.offlineAgents()}},{key:"scrollBottom",value:function(){var e=this;this.focusOnHistory||setTimeout((function(){e.elScroll.scrollTop=e.elScroll.scrollHeight}),0)}}]),View}()},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}}},function(e,t,n){var i=n(18);e.exports=function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,n){t.markdown=n(21),t.parse=t.markdown.toHTML},function(e,t,n){!function(e){var t=e.Markdown=function(e){switch(typeof e){case"undefined":this.dialect=t.dialects.Gruber;break;case"object":this.dialect=e;break;default:if(!(e in t.dialects))throw new Error("Unknown Markdown dialect '"+String(e)+"'");this.dialect=t.dialects[e]}this.em_state=[],this.strong_state=[],this.debug_indent=""};function i(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function r(){var e=n(22);return"Markdown.mk_block( "+e.inspect(this.toString())+", "+e.inspect(this.trailing)+", "+e.inspect(this.lineNumber)+" )"}e.parse=function(e,n){return new t(n).toTree(e)},e.toHTML=function(t,n,i){var r=e.toHTMLTree(t,n,i);return e.renderJsonML(r)},e.toHTMLTree=function(e,t,n){"string"==typeof e&&(e=this.parse(e,t));var i=d(e),r={};i&&i.references&&(r=i.references);var s=function e(t,n,i){var r;i=i||{};var s=t.slice(0);"function"==typeof i.preprocessTreeNode&&(s=i.preprocessTreeNode(s,n));var o=d(s);if(o){for(r in s[1]={},o)s[1][r]=o[r];o=s[1]}if("string"==typeof s)return s;switch(s[0]){case"header":s[0]="h"+s[1].level,delete s[1].level;break;case"bulletlist":s[0]="ul";break;case"numberlist":s[0]="ol";break;case"listitem":s[0]="li";break;case"para":s[0]="p";break;case"markdown":s[0]="html",o&&delete o.references;break;case"code_block":s[0]="pre",r=o?2:1;var a=["code"];a.push.apply(a,s.splice(r,s.length-r)),s[r]=a;break;case"inlinecode":s[0]="code";break;case"img":s[1].src=s[1].href,delete s[1].href;break;case"linebreak":s[0]="br";break;case"link":s[0]="a";break;case"link_ref":if(s[0]="a",!(l=n[o.ref]))return o.original;delete o.ref,o.href=l.href,l.title&&(o.title=l.title),delete o.original;break;case"img_ref":var l;if(s[0]="img",!(l=n[o.ref]))return o.original;delete o.ref,o.src=l.href,l.title&&(o.title=l.title),delete o.original}if(r=1,o){for(var c in s[1]){r=2;break}1===r&&s.splice(r,1)}for(;r<s.length;++r)s[r]=e(s[r],n,i);return s}(e,r,n);return function e(t){var n=d(t)?2:1;for(;n<t.length;)"string"==typeof t[n]?n+1<t.length&&"string"==typeof t[n+1]?t[n]+=t.splice(n+1,1)[0]:++n:(e(t[n]),++n)}(s),s};var s=t.mk_block=function(e,t,n){1==arguments.length&&(t="\n\n");var s=new String(e);return s.trailing=t,s.inspect=r,s.toSource=i,null!=n&&(s.lineNumber=n),s};function o(e){for(var t=0,n=-1;-1!==(n=e.indexOf("\n",n+1));)t++;return t}function l(e,t){var n=e+"_state",i="strong"==e?"em_state":"strong_state";function r(e){this.len_after=e,this.name="close_"+t}return function(s,o){if(this[n][0]==t)return this[n].shift(),[s.length,new r(s.length-t.length)];var a=this[i].slice(),l=this[n].slice();this[n].unshift(t);var c=this.processInline(s.substr(t.length)),h=c[c.length-1];this[n].shift();return h instanceof r?(c.pop(),[s.length-h.len_after,[e].concat(c)]):(this[i]=a,this[n]=l,[t.length,t])}}t.prototype.split_blocks=function(e,t){e=e.replace(/(\r\n|\n|\r)/g,"\n");var n,i=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,r=[],a=1;for(null!=(n=/^(\s*\n)/.exec(e))&&(a+=o(n[0]),i.lastIndex=n[0].length);null!==(n=i.exec(e));)"\n#"==n[2]&&(n[2]="\n",i.lastIndex--),r.push(s(n[1],n[2],a)),a+=o(n[0]);return r},t.prototype.processBlock=function(e,t){var n=this.dialect.block,i=n.__order__;if("__call__"in n)return n.__call__.call(this,e,t);for(var r=0;r<i.length;r++){var s=n[i[r]].call(this,e,t);if(s)return(!h(s)||s.length>0&&!h(s[0]))&&this.debug(i[r],"didn't return a proper array"),s}return[]},t.prototype.processInline=function(e){return this.dialect.inline.__call__.call(this,String(e))},t.prototype.toTree=function(e,t){var n=e instanceof Array?e:this.split_blocks(e),i=this.tree;try{for(this.tree=t||this.tree||["markdown"];n.length;){var r=this.processBlock(n.shift(),n);r.length&&this.tree.push.apply(this.tree,r)}return this.tree}finally{t&&(this.tree=i)}},t.prototype.debug=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,e),"undefined"!=typeof console&&void 0!==console.log&&console.log.apply(null,e)},t.prototype.loop_re_over_block=function(e,t,n){for(var i,r=t.valueOf();r.length&&null!=(i=e.exec(r));)r=r.substr(i[0].length),n.call(this,i);return r},t.dialects={},t.dialects.Gruber={block:{atxHeader:function(e,t){var n=e.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(n){var i=["header",{level:n[1].length}];return Array.prototype.push.apply(i,this.processInline(n[2])),n[0].length<e.length&&t.unshift(s(e.substr(n[0].length),e.trailing,e.lineNumber+2)),[i]}},setextHeader:function(e,t){var n=e.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(n){var i=["header",{level:"="===n[2]?1:2},n[1]];return n[0].length<e.length&&t.unshift(s(e.substr(n[0].length),e.trailing,e.lineNumber+2)),[i]}},code:function(e,t){var n=[],i=/^(?: {0,3}\t| {4})(.*)\n?/;if(e.match(i)){e:for(;;){var r=this.loop_re_over_block(i,e.valueOf(),(function(e){n.push(e[1])}));if(r.length){t.unshift(s(r,e.trailing));break e}if(!t.length)break e;if(!t[0].match(i))break e;n.push(e.trailing.replace(/[^\n]/g,"").substring(2)),e=t.shift()}return[["code_block",n.join("\n")]]}},horizRule:function(e,t){var n=e.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(n){var i=[["hr"]];return n[1]&&i.unshift.apply(i,this.processBlock(n[1],[])),n[3]&&t.unshift(s(n[3])),i}},lists:function(){var e=/[*+-]/,t=new RegExp("^( {0,3})([*+-]|\\d+\\.)[ \t]+"),n="(?: {0,3}\\t| {4})";function i(e,t,n,i){if(t)e.push(["para"].concat(n));else{var r=e[e.length-1]instanceof Array&&"para"==e[e.length-1][0]?e[e.length-1]:e;i&&e.length>1&&n.unshift(i);for(var s=0;s<n.length;s++){var o=n[s];"string"==typeof o&&r.length>1&&"string"==typeof r[r.length-1]?r[r.length-1]+=o:r.push(o)}}}function r(e,t){for(var i=new RegExp("^("+n+"{"+e+"}.*?\\n?)*$"),r=new RegExp("^"+n+"{"+e+"}","gm"),o=[];t.length>0&&i.exec(t[0]);){var a=t.shift(),l=a.replace(r,"");o.push(s(l,a.trailing,a.lineNumber))}return o}function o(e,t,n){var i=e.list,r=i[i.length-1];if(!(r[1]instanceof Array&&"para"==r[1][0]))if(t+1==n.length)r.push(["para"].concat(r.splice(1,r.length-1)));else{var s=r.pop();r.push(["para"].concat(r.splice(1,r.length-1)),s)}}return function(s,a){var l=s.match(t);if(l){for(var h,u,d,m=[],p=T(l),f=!1,_=[m[0].list];;){for(var g=s.split(/(?=\n)/),k="",b=0;b<g.length;b++){var v="",z=g[b].replace(/^\n/,(function(e){return v=e,""})),y=(d=m.length,new RegExp("(?:^("+n+"{0,"+d+"} {0,3})([*+-]|\\d+\\.)\\s+)|(^"+n+"{0,"+(d-1)+"}[ ]{0,4})"));if(void 0!==(l=z.match(y))[1]){k.length&&(i(h,f,this.processInline(k),v),f=!1,k=""),l[1]=l[1].replace(/ {0,3}\t/g,"    ");var x=Math.floor(l[1].length/4)+1;if(x>m.length)p=T(l),h.push(p),h=p[1]=["listitem"];else{var w=!1;for(u=0;u<m.length;u++)if(m[u].indent==l[1]){p=m[u].list,m.splice(u+1,m.length-(u+1)),w=!0;break}w||(++x<=m.length?(m.splice(x,m.length-x),p=m[x-1].list):(p=T(l),h.push(p))),h=["listitem"],p.push(h)}v=""}z.length>l[0].length&&(k+=v+z.substr(l[0].length))}k.length&&(i(h,f,this.processInline(k),v),f=!1,k="");var C=r(m.length,a);C.length>0&&(c(m,o,this),h.push.apply(h,this.toTree(C,[])));var S=a[0]&&a[0].valueOf()||"";if(!S.match(t)&&!S.match(/^ /))break;s=a.shift();var M=this.dialect.block.horizRule(s,a);if(M){_.push.apply(_,M);break}c(m,o,this),f=!0}return _}function T(t){var n=e.exec(t[2])?["bulletlist"]:["numberlist"];return m.push({list:n,indent:t[1]}),n}}}(),blockquote:function(e,t){if(e.match(/^>/m)){var n=[];if(">"!=e[0]){for(var i=e.split(/\n/),r=[],o=e.lineNumber;i.length&&">"!=i[0][0];)r.push(i.shift()),o++;var a=s(r.join("\n"),"\n",e.lineNumber);n.push.apply(n,this.processBlock(a,[])),e=s(i.join("\n"),e.trailing,o)}for(;t.length&&">"==t[0][0];){var l=t.shift();e=s(e+e.trailing+l,l.trailing,e.lineNumber)}var c=e.replace(/^> ?/gm,""),h=(this.tree,this.toTree(c,["blockquote"])),m=d(h);return m&&m.references&&(delete m.references,u(m)&&h.splice(1,1)),n.push(h),n}},referenceDefn:function(e,t){var n=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(e.match(n)){d(this.tree)||this.tree.splice(1,0,{});var i=d(this.tree);void 0===i.references&&(i.references={});var r=this.loop_re_over_block(n,e,(function(e){e[2]&&"<"==e[2][0]&&">"==e[2][e[2].length-1]&&(e[2]=e[2].substring(1,e[2].length-1));var t=i.references[e[1].toLowerCase()]={href:e[2]};void 0!==e[4]?t.title=e[4]:void 0!==e[5]&&(t.title=e[5])}));return r.length&&t.unshift(s(r,e.trailing)),[]}},para:function(e,t){return[["para"].concat(this.processInline(e))]}}},t.dialects.Gruber.inline={__oneElement__:function(e,t,n){var i,r;return t=t||this.dialect.inline.__patterns__,(i=new RegExp("([\\s\\S]*?)("+(t.source||t)+")").exec(e))?i[1]?[i[1].length,i[1]]:(i[2]in this.dialect.inline&&(r=this.dialect.inline[i[2]].call(this,e.substr(i.index),i,n||[])),r=r||[i[2].length,i[2]]):[e.length,e]},__call__:function(e,t){var n,i=[];function r(e){"string"==typeof e&&"string"==typeof i[i.length-1]?i[i.length-1]+=e:i.push(e)}for(;e.length>0;)n=this.dialect.inline.__oneElement__.call(this,e,t,i),e=e.substr(n.shift()),c(n,r);return i},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(e){return this.dialect.inline.__escape__.exec(e)?[2,e.charAt(1)]:[1,"\\"]},"![":function(e){var t=e.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(t){t[2]&&"<"==t[2][0]&&">"==t[2][t[2].length-1]&&(t[2]=t[2].substring(1,t[2].length-1)),t[2]=this.dialect.inline.__call__.call(this,t[2],/\\/)[0];var n={alt:t[1],href:t[2]||""};return void 0!==t[4]&&(n.title=t[4]),[t[0].length,["img",n]]}return(t=e.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/))?[t[0].length,["img_ref",{alt:t[1],ref:t[2].toLowerCase(),original:t[0]}]]:[2,"!["]},"[":function(e){var n=String(e),i=t.DialectHelpers.inline_until_char.call(this,e.substr(1),"]");if(!i)return[1,"["];var r,s,o=1+i[0],a=i[1],l=(e=e.substr(o)).match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(l){var c=l[1];if(o+=l[0].length,c&&"<"==c[0]&&">"==c[c.length-1]&&(c=c.substring(1,c.length-1)),!l[3])for(var h=1,u=0;u<c.length;u++)switch(c[u]){case"(":h++;break;case")":0==--h&&(o-=c.length-u,c=c.substring(0,u))}return s={href:(c=this.dialect.inline.__call__.call(this,c,/\\/)[0])||""},void 0!==l[3]&&(s.title=l[3]),r=["link",s].concat(a),[o,r]}return(l=e.match(/^\s*\[(.*?)\]/))?(o+=l[0].length,r=["link_ref",s={ref:(l[1]||String(a)).toLowerCase(),original:n.substr(0,o)}].concat(a),[o,r]):1==a.length&&"string"==typeof a[0]?(r=["link_ref",s={ref:a[0].toLowerCase(),original:n.substr(0,o)},a[0]],[o,r]):[1,"["]},"<":function(e){var t;return null!=(t=e.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?t[3]?[t[0].length,["link",{href:"mailto:"+t[3]},t[3]]]:"mailto"==t[2]?[t[0].length,["link",{href:t[1]},t[1].substr("mailto:".length)]]:[t[0].length,["link",{href:t[1]},t[1]]]:[1,"<"]},"`":function(e){var t=e.match(/(`+)(([\s\S]*?)\1)/);return t&&t[2]?[t[1].length+t[2].length,["inlinecode",t[3]]]:[1,"`"]},"  \n":function(e){return[3,["linebreak"]]}},t.dialects.Gruber.inline["**"]=l("strong","**"),t.dialects.Gruber.inline.__=l("strong","__"),t.dialects.Gruber.inline["*"]=l("em","*"),t.dialects.Gruber.inline._=l("em","_"),t.buildBlockOrder=function(e){var t=[];for(var n in e)"__order__"!=n&&"__call__"!=n&&t.push(n);e.__order__=t},t.buildInlinePatterns=function(e){var t=[];for(var n in e)if(!n.match(/^__.*__$/)){var i=n.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");t.push(1==n.length?i:"(?:"+i+")")}t=t.join("|"),e.__patterns__=t;var r=e.__call__;e.__call__=function(e,n){return null!=n?r.call(this,e,n):r.call(this,e,t)}},t.DialectHelpers={},t.DialectHelpers.inline_until_char=function(e,t){for(var n=0,i=[];;){if(e.charAt(n)==t)return[++n,i];if(n>=e.length)return null;var r=this.dialect.inline.__oneElement__.call(this,e.substr(n));n+=r[0],i.push.apply(i,r.slice(1))}},t.subclassDialect=function(e){function t(){}function n(){}return t.prototype=e.block,n.prototype=e.inline,{block:new t,inline:new n}},t.buildBlockOrder(t.dialects.Gruber.block),t.buildInlinePatterns(t.dialects.Gruber.inline),t.dialects.Maruku=t.subclassDialect(t.dialects.Gruber),t.dialects.Maruku.processMetaHash=function(e){for(var t=function(e){var t=e.split(""),n=[""],i=!1;for(;t.length;){var r=t.shift();switch(r){case" ":i?n[n.length-1]+=r:n.push("");break;case"'":case'"':i=!i;break;case"\\":r=t.shift();default:n[n.length-1]+=r}}return n}(e),n={},i=0;i<t.length;++i)if(/^#/.test(t[i]))n.id=t[i].substring(1);else if(/^\./.test(t[i]))n.class?n.class=n.class+t[i].replace(/./," "):n.class=t[i].substring(1);else if(/\=/.test(t[i])){var r=t[i].split(/\=/);n[r[0]]=r[1]}return n},t.dialects.Maruku.block.document_meta=function(e,t){if(!(e.lineNumber>1)&&e.match(/^(?:\w+:.*\n)*\w+:.*$/)){d(this.tree)||this.tree.splice(1,0,{});var n=e.split(/\n/);for(p in n){var i=n[p].match(/(\w+):\s*(.*)$/),r=i[1].toLowerCase(),s=i[2];this.tree[1][r]=s}return[]}},t.dialects.Maruku.block.block_meta=function(e,t){var n=e.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(n){var i,r=this.dialect.processMetaHash(n[2]);if(""===n[1]){var s=this.tree[this.tree.length-1];if(i=d(s),"string"==typeof s)return;for(a in i||(i={},s.splice(1,0,i)),r)i[a]=r[a];return[]}var o=e.replace(/\n.*$/,""),l=this.processBlock(o,[]);for(a in(i=d(l[0]))||(i={},l[0].splice(1,0,i)),r)i[a]=r[a];return l}},t.dialects.Maruku.block.definition_list=function(e,t){var n,i=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,r=["dl"];if(a=e.match(i)){for(var s=[e];t.length&&i.exec(t[0]);)s.push(t.shift());for(var o=0;o<s.length;++o){var a,l=(a=s[o].match(i))[1].replace(/\n$/,"").split(/\n/),c=a[2].split(/\n:\s+/);for(n=0;n<l.length;++n)r.push(["dt",l[n]]);for(n=0;n<c.length;++n)r.push(["dd"].concat(this.processInline(c[n].replace(/(\n)\s+/,"$1"))))}return[r]}},t.dialects.Maruku.block.table=function(e,t){var n,i,r=function(e,t){(t=t||"\\s").match(/^[\\|\[\]{}?*.+^$]$/)&&(t="\\"+t);for(var n,i=[],r=new RegExp("^((?:\\\\.|[^\\\\"+t+"])*)"+t+"(.*)");n=e.match(r);)i.push(n[1]),e=n[2];return i.push(e),i};if(i=e.match(/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/))i[3]=i[3].replace(/^\s*\|/gm,"");else if(!(i=e.match(/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/)))return;var s=["table",["thead",["tr"]],["tbody"]];i[2]=i[2].replace(/\|\s*$/,"").split("|");var o=[];for(c(i[2],(function(e){e.match(/^\s*-+:\s*$/)?o.push({align:"right"}):e.match(/^\s*:-+\s*$/)?o.push({align:"left"}):e.match(/^\s*:-+:\s*$/)?o.push({align:"center"}):o.push({})})),i[1]=r(i[1].replace(/\|\s*$/,""),"|"),n=0;n<i[1].length;n++)s[1][1].push(["th",o[n]||{}].concat(this.processInline(i[1][n].trim())));return c(i[3].replace(/\|\s*$/gm,"").split("\n"),(function(e){var t=["tr"];for(e=r(e,"|"),n=0;n<e.length;n++)t.push(["td",o[n]||{}].concat(this.processInline(e[n].trim())));s[2].push(t)}),this),[s]},t.dialects.Maruku.inline["{:"]=function(e,t,n){if(!n.length)return[2,"{:"];var i=n[n.length-1];if("string"==typeof i)return[2,"{:"];var r=e.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!r)return[2,"{:"];var s=this.dialect.processMetaHash(r[1]),o=d(i);for(var a in o||(o={},i.splice(1,0,o)),s)o[a]=s[a];return[r[0].length,""]},t.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/,t.buildBlockOrder(t.dialects.Maruku.block),t.buildInlinePatterns(t.dialects.Maruku.inline);var c,h=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)};c=Array.prototype.forEach?function(e,t,n){return e.forEach(t,n)}:function(e,t,n){for(var i=0;i<e.length;i++)t.call(n||e,e[i],i,e)};var u=function(e){for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0};function d(e){return h(e)&&e.length>1&&"object"==typeof e[1]&&!h(e[1])?e[1]:void 0}function m(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function f(e){if("string"==typeof e)return m(e);var t=e.shift(),n={},i=[];for(!e.length||"object"!=typeof e[0]||e[0]instanceof Array||(n=e.shift());e.length;)i.push(f(e.shift()));var r="";for(var s in n)r+=" "+s+'="'+m(n[s])+'"';return"img"==t||"br"==t||"hr"==t?"<"+t+r+"/>":"<"+t+r+">"+i.join("")+"</"+t+">"}e.renderJsonML=function(e,t){(t=t||{}).root=t.root||!1;var n=[];if(t.root)n.push(f(e));else for(e.shift(),!e.length||"object"!=typeof e[0]||e[0]instanceof Array||e.shift();e.length;)n.push(f(e.shift()));return n.join("\n\n")}}(t)},function(e,t,n){(function(e){var i=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},i=0;i<t.length;i++)n[t[i]]=Object.getOwnPropertyDescriptor(e,t[i]);return n},r=/%[sdj%]/g;t.format=function(e){if(!g(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,s=i.length,o=String(e).replace(r,(function(e){if("%%"===e)return"%";if(n>=s)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}})),l=i[n];n<s;l=i[++n])f(l)||!v(l)?o+=" "+l:o+=" "+a(l);return o},t.deprecate=function(n,i){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,i).apply(this,arguments)};var r=!1;return function(){if(!r){if(e.throwDeprecation)throw new Error(i);e.traceDeprecation?console.trace(i):console.error(i),r=!0}return n.apply(this,arguments)}};var s,o={};function a(e,n){var i={seen:[],stylize:c};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),p(n)?i.showHidden=n:n&&t._extend(i,n),k(i.showHidden)&&(i.showHidden=!1),k(i.depth)&&(i.depth=2),k(i.colors)&&(i.colors=!1),k(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=l),h(i,e,i.depth)}function l(e,t){var n=a.styles[t];return n?"["+a.colors[n][0]+"m"+e+"["+a.colors[n][1]+"m":e}function c(e,t){return e}function h(e,n,i){if(e.customInspect&&n&&x(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var r=n.inspect(i,e);return g(r)||(r=h(e,r,i)),r}var s=function(e,t){if(k(t))return e.stylize("undefined","undefined");if(g(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(_(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(f(t))return e.stylize("null","null")}(e,n);if(s)return s;var o=Object.keys(n),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),y(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return u(n);if(0===o.length){if(x(n)){var l=n.name?": "+n.name:"";return e.stylize("[Function"+l+"]","special")}if(b(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(z(n))return e.stylize(Date.prototype.toString.call(n),"date");if(y(n))return u(n)}var c,v="",w=!1,C=["{","}"];(m(n)&&(w=!0,C=["[","]"]),x(n))&&(v=" [Function"+(n.name?": "+n.name:"")+"]");return b(n)&&(v=" "+RegExp.prototype.toString.call(n)),z(n)&&(v=" "+Date.prototype.toUTCString.call(n)),y(n)&&(v=" "+u(n)),0!==o.length||w&&0!=n.length?i<0?b(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=w?function(e,t,n,i,r){for(var s=[],o=0,a=t.length;o<a;++o)T(t,String(o))?s.push(d(e,t,n,i,String(o),!0)):s.push("");return r.forEach((function(r){r.match(/^\d+$/)||s.push(d(e,t,n,i,r,!0))})),s}(e,n,i,a,o):o.map((function(t){return d(e,n,i,a,t,w)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,v,C)):C[0]+v+C[1]}function u(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,i,r,s){var o,a,l;if((l=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),T(i,r)||(o="["+r+"]"),a||(e.seen.indexOf(l.value)<0?(a=f(n)?h(e,l.value,null):h(e,l.value,n-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),k(o)){if(s&&r.match(/^\d+$/))return a;(o=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function m(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function f(e){return null===e}function _(e){return"number"==typeof e}function g(e){return"string"==typeof e}function k(e){return void 0===e}function b(e){return v(e)&&"[object RegExp]"===w(e)}function v(e){return"object"==typeof e&&null!==e}function z(e){return v(e)&&"[object Date]"===w(e)}function y(e){return v(e)&&("[object Error]"===w(e)||e instanceof Error)}function x(e){return"function"==typeof e}function w(e){return Object.prototype.toString.call(e)}function C(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(k(s)&&(s=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!o[n])if(new RegExp("\\b"+n+"\\b","i").test(s)){var i=e.pid;o[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,i,e)}}else o[n]=function(){};return o[n]},t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=m,t.isBoolean=p,t.isNull=f,t.isNullOrUndefined=function(e){return null==e},t.isNumber=_,t.isString=g,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=k,t.isRegExp=b,t.isObject=v,t.isDate=z,t.isError=y,t.isFunction=x,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(24);var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function M(){var e=new Date,t=[C(e.getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":");return[e.getDate(),S[e.getMonth()],t].join(" ")}function T(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",M(),t.format.apply(t,arguments))},t.inherits=n(25),t._extend=function(e,t){if(!t||!v(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e};var j="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function A(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(j&&e[j]){var t;if("function"!=typeof(t=e[j]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,j,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,i=new Promise((function(e,i){t=e,n=i})),r=[],s=0;s<arguments.length;s++)r.push(arguments[s]);r.push((function(e,i){e?n(e):t(i)}));try{e.apply(this,r)}catch(e){n(e)}return i}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),j&&Object.defineProperty(t,j,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,i(e))},t.promisify.custom=j,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],i=0;i<arguments.length;i++)n.push(arguments[i]);var r=n.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var s=this,o=function(){return r.apply(s,arguments)};t.apply(this,n).then((function(t){e.nextTick(o,null,t)}),(function(t){e.nextTick(A,t,o)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,i(t)),n}}).call(this,n(23))},function(e,t){var n,i,r=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var l,c=[],h=!1,u=-1;function d(){h&&l&&(h=!1,l.length?c=l.concat(c):u=-1,c.length&&m())}function m(){if(!h){var e=a(d);h=!0;for(var t=c.length;t;){for(l=c,c=[];++u<t;)l&&l[u].run();u=-1,t=c.length}l=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||h||a(m)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";n.r(t),n.d(t,"startBlink",(function(){return h})),n.d(t,"stopBlink",(function(){return u}));var i=n(0),r=n.n(i),s=n(1),o=n.n(s),a=function(){function e(){r()(this,e),this.sprites=[],this.step=0,this.interval=0,this.delay=600,this.fetchLinks(),this.generateSprites(2,16,16,"red")}return o()(e,[{key:"fetchLinks",value:function(){var e=document.head.querySelectorAll('link[type="image/png"], link[type="image/x-icon"]');this.links=Object.values(e).map((function(e){return{el:e,originalUrl:e.href,originalType:e.type}}))}},{key:"generateSprites",value:function(e,t,n,i){for(var r=0;r<e;r++){var s=document.createElement("canvas");s.width=t,s.height=n;var o=t/(3*(r+1)),a=t/2,l=n/2,c=s.getContext("2d");c.beginPath(),c.arc(a,l,o,0,2*Math.PI,!1),c.fillStyle=i,c.fill(),this.sprites.push(s.toDataURL())}}},{key:"start",value:function(){var e=this;if(!this.interval){var t=function(){e.links.map((function(t){t.el.href=e.sprites[e.step%e.sprites.length],t.el.type="image/png"})),e.step++};t(),this.interval=setInterval((function(){t()}),this.delay)}}},{key:"stop",value:function(){clearInterval(this.interval),this.interval=null,this.links.map((function(e){e.el.href=e.originalUrl,e.el.type=e.originalType}))}}]),e}(),l=new(function(){function e(){r()(this,e),this.delay=1200,this.showed=!1,this.interval=null,this.defaultTitle=null,this.title=null}return o()(e,[{key:"start",value:function(e){e&&(this.title=e,this.interval||(this.toggle(),this.interval=setInterval(this.toggle.bind(this),this.delay)))}},{key:"stop",value:function(){null!==this.interval&&(clearInterval(this.interval),this.interval=null,this.hide())}},{key:"toggle",value:function(){this.showed?this.hide():this.show()}},{key:"show",value:function(){document.title!==this.defaultTitle&&(this.defaultTitle=document.title),document.title=this.title,this.showed=!0}},{key:"hide",value:function(){document.title!==this.title&&(this.defaultTitle=document.title),document.title=this.defaultTitle,this.showed=!1}}]),e}()),c=new a,h=function(e){l.start(e),c.start()},u=function(){l.stop(),c.stop()}},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return m}));var i=n(2),r=n.n(i),s=n(0),o=n.n(s),a=n(1),l=n.n(a),c=n(9),h=n(3),u=n(5),d=n(28),m=function(){function e(t){o()(this,e),this.app=t.app,this.view=t,this.appearance=this.app.settings.appearance,this.behavior=this.app.settings.behavior}return l()(e,[{key:"safe",value:function(e){return h.htmlToText(e)}},{key:"t",value:function(e){return u[this.app.locale][e]}},{key:"attribute",value:function(e){return e?String(e).replace(/\"/gi,"&quot;"):""}},{key:"offers",value:function(e){return e?'\n    <div class="mkz-c-o">\n      '.concat(e.map(this.offer.bind(this)).join("\n"),"\n    </div>"):""}},{key:"offer",value:function(e,t,n){var i=e.icon?'\n          <img src="'.concat(this.safe(e.icon),'" alt="" class="mkz-c-o__preview-img" />\n    '):'\n          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="480" height="448" viewBox="0 0 480 448" class="mkz-c-o__preview-img">\n            <path fill="currentColor" d="M160 144c0 26.5-21.5 48-48 48s-48-21.5-48-48 21.5-48 48-48 48 21.5 48 48zM416 240v112h-352v-48l80-80 40 40 128-128zM440 64h-400c-4.25 0-8 3.75-8 8v304c0 4.25 3.75 8 8 8h400c4.25 0 8-3.75 8-8v-304c0-4.25-3.75-8-8-8zM480 72v304c0 22-18 40-40 40h-400c-22 0-40-18-40-40v-304c0-22 18-40 40-40h400c22 0 40 18 40 40z"></path>\n          </svg>\n    ',r=n.length<2?"":'\n        <div class="mkz-c-o__counter">\n          '.concat(t+1,"/").concat(n.length,"\n        </dvi>\n    "),s=this.t(this.behavior.attachment_cta.product.callback_label_text),o=this.t(this.behavior.attachment_cta.product.label_text);return'\n      <div class="mkz-c-o__i">\n        <div class="mkz-c-o__content">\n          <a href="'.concat(this.safe(e.url),'" class="mkz-c-o__preview-link">\n            ').concat(i,'\n          </a>\n          <div class="mkz-c-o__name">\n            <a href="').concat(this.safe(e.url),'" class="mkz-c-o__name-link">').concat(this.safe(e.name),'</a>\n          </div>\n          <div class="mkz-c-o__info">\n            <div class="mkz-c-o__info-price">\n              ').concat(this.safe(e.display_price),'\n            </div>\n          </div>\n          <div class="mkz-c-o__action">\n            <span\n              data-data="').concat(this.attribute(JSON.stringify(e)),'"\n              data-callback_label="').concat(this.attribute(s),'"\n              class="mkz-c-o__btn mkz-c-o-js-action"\n            >\n              ').concat(o,"\n            </span>\n          </div>\n        </div>\n        ").concat(r,"\n      </div>\n    ")}},{key:"files",value:function(e){return'\n      <div class="mkz-c-f">\n        '.concat(e.map(this.file.bind(this)).join("\n"),"\n      </div>\n    ")}},{key:"file",value:function(e,t,n){return e.url?'\n      <div class="mkz-c-f__i">\n        <a href="'.concat(e.url,'" target="_blank" class="mkz-c-f__link">\n          <span class="mkz-c-f__preview">\n            <svg width="18" height="20" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M10 10H13L9 14L5 10H8V6H10V10ZM12 2H2V18H16V6H12V2ZM0 0.992C0 0.444 0.447 0 0.999 0H13L18 5V18.993C18.0009 19.1243 17.976 19.2545 17.9266 19.3762C17.8772 19.4979 17.8043 19.6087 17.7121 19.7022C17.6199 19.7957 17.5101 19.8701 17.3892 19.9212C17.2682 19.9723 17.1383 19.9991 17.007 20H0.993C0.730378 19.9982 0.479017 19.8931 0.293218 19.7075C0.107418 19.5219 0.00209465 19.2706 0 19.008V0.992Z" fill="currentColor"/>\n            </svg>\n          </span>\n          <span class="mkz-c-f__content">\n            <span class="mkz-c-f__text">\n              <span class="mkz-c-f__name">').concat(e.name||e.url,'</span>\n              <span class="mkz-c-f__size">').concat(e.size?h.formatFileSize(e.size):"","</span>\n            </span>\n          </span>\n        </a>\n      </div>"):""}},{key:"images",value:function(e){return'\n      <div class="mkz-c-i">\n        '.concat(e.map(this.image.bind(this)).join("\n"),"\n      </div>\n    ")}},{key:"image",value:function(e,t,n){if(!e.url)return"";var i=n.length;return'\n      <div class="mkz-c-i__i mkz-c-i__i_type_'.concat(1===i?2:t%3,'">\n        <a\n          href="').concat(e.url,'"\n          target="_blank"\n          class="mkz-c-i__link mkz-c-i-js"\n          style="background-image: url(\'').concat(this.attribute(e.url),"')\"\n        ></a>\n      </div>")}},{key:"form",value:function(e,t){var n=this,i=e.map((function(e){switch(e.display_type){case"email":return n.formText(e,"email");case"numeric":return n.formText(e,"text","numeric");case"integer":return n.formText(e,"text","integer");case"boolean":return n.formBoolean(e);case"select":return n.formSelect(e);case"date":return n.formDate(e);case"hint":return n.formHint(e);case"button":return n.formButton(e);default:return n.formText(e,"text")}})).filter((function(e){return e})).map((function(e){return'<div class="mkz-f__row">'.concat(e,"</div>")})).join("");return'\n      <form class="mkz-f mkz-f-js" data-uid="'.concat(this.attribute(t),'" novalidate autocomplete="off">').concat(i,"</form>")}},{key:"formText",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return'\n    <label class="mkz-f__label">'.concat(this.safe(e.display_name),'</label>\n    <div class="mkz-f__control ').concat(e.disabled?"mkz-f__control_type_success":"",'">\n      <input\n        type="').concat(t,'"\n        name="').concat(e.field,'"\n        class="mkz-f__input"\n        value="').concat(this.attribute(e.value),'"\n        ').concat(e.disabled?'disabled="true"':"","\n        ").concat(e.required?"required":"","\n        ").concat(n,"\n      />\n    </div>\n    ")}},{key:"formDate",value:function(e){return'\n    <label class="mkz-f__label">'.concat(this.safe(e.display_name),'</label>\n    <div class="mkz-f__control ').concat(e.disabled?"mkz-f__control_type_success":"",'">\n      <input\n        type="date"\n        name="').concat(e.field,'"\n        class="mkz-f__input"\n        pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}"\n        value="').concat(this.attribute(e.value),'"\n        ').concat(e.disabled?'disabled="true"':"","\n        ").concat(e.required?"required":"","\n      />\n    </div>\n    ")}},{key:"formBoolean",value:function(e){var t=this,n={"":"-",true:this.t("true"),false:this.t("false")},i=Object.entries(n).map((function(n){var i=r()(n,2),s=i[0],o=i[1],a=e.value===String(s)?'selected="selected"':"";return'<option value="'.concat(t.attribute(s),'" ').concat(a,">").concat(t.safe(o),"</option>")})).join("");return'\n    <label class="mkz-f__label">'.concat(this.safe(e.display_name),'</label>\n    <div class="mkz-f__control ').concat(e.disabled?"mkz-f__control_type_success":"",'">\n      <select\n        name="').concat(e.field,'"\n        class="mkz-f__select"\n        ').concat(e.disabled?'disabled="true"':"","\n        ").concat(e.required?"required":"","\n      >").concat(i,"</select>\n    </div>\n    ")}},{key:"formSelect",value:function(e){var t=this,n=[["","-"]].concat(Object.entries(e.predefined_values)).map((function(n){var i=r()(n,2),s=i[0],o=i[1],a=e.value===s?'selected="selected"':"";return'<option value="'.concat(t.attribute(s),'" ').concat(a,">").concat(t.safe(o),"</option>")})).join("");return'\n    <label class="mkz-f__label">'.concat(this.safe(e.display_name),'</label>\n    <div class="mkz-f__control ').concat(e.disabled?"mkz-f__control_type_success":"",'">\n      <select\n        name="').concat(e.field,'"\n        class="mkz-f__select"\n        ').concat(e.disabled?'disabled="true"':"","\n        ").concat(e.required?"required":"","\n      >").concat(n,"</select>\n    </div>\n    ")}},{key:"formHint",value:function(e){if(!e.disabled)return'\n    <div class="mkz-f__note">'.concat(this.safe(e.display_name),"</div>\n    ")}},{key:"formButton",value:function(e){if(!e.disabled)return'\n    <button type="submit" class="mkz-f__btn">'.concat(this.safe(e.display_name),"</button>\n    ")}},{key:"attachments",value:function(e){var t=this,n=(e.attachments||[]).reduce((function(e,t){return e[t.type]||(e[t.type]=[]),e[t.type].push(t),e}),{});return Object.entries(n).map((function(e){var n=r()(e,2),i=n[0],s=n[1];switch(i){case"product":return t.offers(s);case"file":return t.files(s);case"image":return t.images(s)}}))}},{key:"isClientMsg",value:function(e){return"client"===e.sender_type}},{key:"getDate",value:function(e){var t=e.sent_at.replace(/\.[0-9]+Z$/g,""),n=new Date(t),i=new Date(n.getTime()-6e4*n.getTimezoneOffset());return d(i,this.t(function(e){var t=new Date;return e.getDate()==t.getDate()&&e.getMonth()==t.getMonth()&&e.getFullYear()==t.getFullYear()}(i)?"time":"dateTime"))}},{key:"message",value:function(e){var t=this.isClientMsg(e),n=this.app.settings.appearance.agent_avatar,i=e.sender_avatar_url||this.view.defaultAvatarUrl,r=n?'<div class="mkz-c__i-avatar"><img src="'.concat(this.safe(i),'" srcset="').concat(h.srcset(i),'" class="mkz-c__i-avatar-img" alt="" title="').concat(this.safe(e.sender_name),'" /></div>'):"",s=[];return s.push(this.getDate(e)),!t&&e.sender_name&&s.push(this.safe(e.sender_name)),'\n          <div class="mkz-c__i mkz-c__i_type_'.concat(t?"client":"agent",'" data-id="').concat(e.muid,'">\n            ').concat(r,'\n            <div class="mkz-c__i-content">\n              <div class="mkz-c__i-blocks">\n                ').concat(this.messageContent(e),'\n              </div>\n              <div class="mkz-c__i-info">\n                ').concat(s.join(", "),"\n              </div>\n            </div>\n          </div>")}},{key:"messageBlockWrap",value:function(e){return'\n      <div class="mkz-c__i-msg-block">\n        '.concat(e,"\n      </div>\n    ")}},{key:"messageContent",value:function(e){var t=this,n=this.isClientMsg(e),i=n?this.appearance.client_msg_bg:this.appearance.agent_msg_bg,r=n?this.appearance.client_msg_color:this.appearance.agent_msg_color,s=function(e){return'\n        <div class="mkz-c__i-msg" style="background-color: '.concat(t.safe(i),"; color: ").concat(t.safe(r),'">\n          <div class="mkz-c__i-msg-overflow">\n            ').concat(e,"\n          </div>\n        </div>\n    ")},o=[];switch(e.msg_type){case"survey:show":var a=e.custom_fields,l=a.submitted,c=a.elements.map((function(e){return"select"!==e.type||e.value||(e.value=a.values&&a.values[e.field]),l&&(e.disabled=!0),e}));e.text&&o.push(s(h.htmlFormatting(e.text))),o.push(this.form(c,e.muid)),l&&a.follow_up_text&&o.push(s(h.htmlFormatting(a.follow_up_text)));break;default:var u=h.htmlFormatting(e.text);u&&o.push(s(u)),this.attachments(e).forEach((function(e){o.push(e)}))}return o.map(this.messageBlockWrap).join("")}},{key:"doc",value:function(e){return'\n            <div class="mkz-c-docs__i">\n              <div class="mkz-c-docs__btn">\n                '.concat(this.safe(e),"\n              </div>\n            </div>")}},{key:"docs",value:function(){return""}},{key:"copy",value:function(){return this.appearance.markeaze_link?'\n      <div class="mkz-c__copy-wrap">\n        <a class="mkz-c__copy" href="https://markeaze.com/?utm_source=markeaze&utm_medium=ref&utm_campaign=chatbox" target="_blank">\n          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="mkz-c__copy-logo">\n            <path d="M0 8C0 6.76133 0 6.14198 0.0820778 5.62378C0.533889 2.77116 2.77116 0.533889 5.62378 0.0820778C6.14198 0 6.76133 0 8 0C9.23867 0 9.85802 0 10.3762 0.0820778C13.2288 0.533889 15.4661 2.77116 15.9179 5.62378C16 6.14198 16 6.76133 16 8V16H8C6.76133 16 6.14198 16 5.62378 15.9179C2.77116 15.4661 0.533889 13.2288 0.0820778 10.3762C0 9.85802 0 9.23867 0 8Z" fill="#FC6881"/>\n            <rect x="8" y="4.22223" width="5.33333" height="5.33333" transform="rotate(45 8 4.22223)" fill="white"/>\n          </svg>\n          <span class="mkz-c__copy-text">'.concat(this.t("copyright"),"</span>\n        </a>\n      </div>"):""}},{key:"notice",value:function(){return this.appearance.notice_text&&this.appearance.notice_text.trim()?'\n      <div class="mkz-c__tooltip mkz-c__tooltip_picture_yes" style="color: '.concat(this.safe(this.appearance.notice_color),"; background-color: ").concat(this.safe(this.appearance.notice_bg),'">\n        <img src="').concat(this.safe(this.appearance.notice_icon_url),'" class="mkz-c__tooltip-picture" alt="" />\n        <div class="mkz-c__tooltip-text">\n          ').concat(this.safe(this.appearance.notice_text),"\n        </div>\n      </div>"):""}},{key:"content",value:function(){var e=["l-t","l-b","l"].indexOf(this.appearance.bar_position)>-1?"left":"right";return'\n<div mkz>\n  <div class="mkz-c mkz-c-js">\n\n    <div class="mkz-c__handler mkz-c__handler_type_'.concat(this.safe(this.appearance.bar_type)," mkz-c__handler_position_").concat(this.safe(this.appearance.bar_position)," ").concat(this.appearance.bar_bouncing?"mkz-c__handler_bouncing_yes":"",'" style="margin: ').concat(this.safe(this.appearance.bar_padding_y),"px ").concat(this.safe(this.appearance.bar_padding_x),'px">\n      ').concat(this.notice(),'\n      <div class="mkz-c__btn mkz-c-js-toggle" style="background-color: ').concat(this.appearance.bar_bg,"; color: ").concat(this.safe(this.appearance.bar_color),';">\n        <div class="mkz-c__btn-text">\n          <span class="mkz-c__btn-text-online">').concat(this.safe(this.appearance.bar_text_online),'</span>\n          <span class="mkz-c__btn-text-offline">').concat(this.safe(this.appearance.bar_text_offline),'</span>\n        </div>\n        <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg" class="mkz-c__btn-picture">\n          <rect x="20" y="20" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -12.4091 29.9928)" fill="#FFFFFF" width="20" height="20" fill="currentColor" class="mkz-c__btn-1" />\n          <rect x="20" y="20" fill="#FFFFFF" width="20" height="20" fill="currentColor" class="mkz-c__btn-2" />\n          <rect x="20" y="20" fill="#FFFFFF" width="20" height="20" fill="currentColor" class="mkz-c__btn-3" />\n        </svg>\n        <div class="mkz-c__btn-unread mkz-c-js-unread">0</div>\n      </div>\n    </div>\n\n    <div class="mkz-c__chat mkz-c__chat_position_').concat(e,'" style="').concat(this.view.width?"max-width: ".concat(this.view.width,"px;"):"",'">\n      <div class="mkz-c__cart-shadow"></div>\n      <div class="mkz-c__cart mkz-c-js-cart">\n\n        <div class="mkz-c__head" style="color: ').concat(this.safe(this.appearance.title_color),"; background-color: ").concat(this.safe(this.appearance.title_bg),';">\n\n          <div class="mkz-c__head-row mkz-c__head-row_type_agent">\n            <div class="mkz-c__head-title mkz-c__overflow">\n              ').concat(this.safe(this.appearance.title_text),'\n            </div>\n            <div class="mkz-c__head-action">\n              <div class="mkz-c__mute mkz-c-js-mute">\n                <svg width="16" height="17" viewBox="0 0 14 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n                  <path d="M11.5 6.5C11.5 5.30653 11.0259 4.16193 10.182 3.31802C9.33807 2.47411 8.19347 2 7 2C5.80653 2 4.66193 2.47411 3.81802 3.31802C2.97411 4.16193 2.5 5.30653 2.5 6.5V12.5H11.5V6.5ZM13 13.0002L13.3 13.4C13.3418 13.4557 13.3672 13.522 13.3735 13.5913C13.3797 13.6607 13.3666 13.7304 13.3354 13.7927C13.3043 13.855 13.2564 13.9074 13.1971 13.944C13.1379 13.9806 13.0696 14 13 14H1C0.930358 14 0.862092 13.9806 0.802851 13.944C0.74361 13.9074 0.695735 13.855 0.66459 13.7927C0.633445 13.7304 0.620261 13.6607 0.626515 13.5913C0.63277 13.522 0.658215 13.4557 0.7 13.4L1 13.0002V6.5C1 4.9087 1.63214 3.38258 2.75736 2.25736C3.88258 1.13214 5.4087 0.5 7 0.5C8.5913 0.5 10.1174 1.13214 11.2426 2.25736C12.3679 3.38258 13 4.9087 13 6.5V13.0002ZM5.125 14.75H8.875C8.875 15.2473 8.67746 15.7242 8.32583 16.0758C7.97419 16.4275 7.49728 16.625 7 16.625C6.50272 16.625 6.02581 16.4275 5.67417 16.0758C5.32254 15.7242 5.125 15.2473 5.125 14.75Z" fill="currentColor" />\n                </svg>\n              </div>\n              <div class="mkz-c__unmute mkz-c-js-unmute">\n                <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n                  <path d="M12.9395 14H2.00005C1.93041 14 1.86214 13.9806 1.8029 13.944C1.74366 13.9074 1.69578 13.855 1.66464 13.7927C1.63349 13.7304 1.62031 13.6607 1.62656 13.5913C1.63282 13.522 1.65826 13.4557 1.70005 13.4L2.00005 13.0002V6.49999C2.00005 5.50249 2.24305 4.56199 2.6743 3.73474L0.0447998 1.10599L1.10605 0.0447388L15.9553 14.8947L14.894 15.9552L12.9395 14ZM3.80605 4.86649C3.60326 5.3872 3.49948 5.94119 3.50005 6.49999V12.5H11.4395L3.80605 4.86649ZM14 10.8395L12.5 9.33949V6.49999C12.5002 5.71074 12.2928 4.93533 11.8986 4.25158C11.5043 3.56782 10.9372 2.99977 10.2541 2.60443C9.57105 2.20908 8.79599 2.00035 8.00674 1.99918C7.2175 1.998 6.44182 2.20443 5.75755 2.59774L4.67005 1.50874C5.5736 0.905901 6.62385 0.559648 7.70876 0.506916C8.79368 0.454183 9.87255 0.69695 10.8303 1.20932C11.7881 1.72169 12.5888 2.48444 13.147 3.4162C13.7052 4.34797 14.0001 5.4138 14 6.49999V10.8395ZM6.12505 14.75H9.87505C9.87505 15.2473 9.67751 15.7242 9.32587 16.0758C8.97424 16.4274 8.49733 16.625 8.00005 16.625C7.50277 16.625 7.02586 16.4274 6.67422 16.0758C6.32259 15.7242 6.12505 15.2473 6.12505 14.75Z" fill="currentColor" />\n                </svg>\n              </div>\n            </div>\n            <div class="mkz-c__head-action">\n              <div class="mkz-c__close mkz-c-js-close">\n                <svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">\n                  <path d="M5 3.81846L8.88906 8.56553e-07L10 1.09077L5 6L-5.24496e-07 1.09077L1.11094 1.76568e-07L5 3.81846Z" fill="currentColor" />\n                </svg>\n              </div>\n            </div>\n          </div>\n\n          <div class="mkz-c__head-row">\n            <div class="mkz-c__head-state">\n              <div class="mkz-c__state-wrap">\n                <img class="mkz-c__m-assign-avatar mkz-c-js-agent-avatar" alt="" />\n                <div class="mkz-c__state"></div>\n              </div>\n            </div>\n            <div class="mkz-c__head-m">\n              <div class="mkz-c__m-assign-text mkz-c__overflow mkz-c-js-agent-name"></div>\n              <div class="mkz-c__m-assign-post mkz-c__overflow mkz-c-js-agent-post"></div>\n            </div>\n          </div>\n\n        </div>\n\n        <div class="mkz-c__content">\n          <div class="mkz-c__scroll mkz-c-js-scroll">\n            <div class="mkz-c__list mkz-c-js-history"></div>\n            ').concat(this.copy(),"\n          </div>\n        </div>\n\n        ").concat(this.docs(),'\n\n        <label class="mkz-c__footer">\n          <div class="mkz-c__footer-msg">\n            <textarea class="mkz-c__input mkz-c-js-input" rows="1" placeholder="').concat(this.safe(this.appearance.placeholder||this.t("placeholder")),'"></textarea>\n          </div>\n          <div class="mkz-c__footer-btn">\n            <div class="mkz-c__submit mkz-c-js-submit">\n              <svg width="19" height="20" viewBox="0 0 19 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M1.42925 0.290672L18.3527 9.59851C18.4246 9.63807 18.4845 9.6962 18.5263 9.76682C18.568 9.83744 18.59 9.91797 18.59 10C18.59 10.082 18.568 10.1626 18.5263 10.2332C18.4845 10.3038 18.4246 10.3619 18.3527 10.4015L1.42925 19.7093C1.35947 19.7477 1.28089 19.7673 1.20125 19.766C1.12161 19.7648 1.04367 19.7428 0.975112 19.7023C0.906549 19.6618 0.84973 19.6041 0.810256 19.5349C0.770781 19.4657 0.750014 19.3875 0.75 19.3078V0.692172C0.750014 0.612527 0.770781 0.534261 0.810256 0.465086C0.84973 0.395912 0.906549 0.338218 0.975112 0.297691C1.04367 0.257164 1.12161 0.235203 1.20125 0.233972C1.28089 0.232741 1.35947 0.252283 1.42925 0.290672ZM2.58333 10.9167V16.9823L15.2792 10L2.58333 3.01776V9.08334H7.16667V10.9167H2.58333Z" fill="currentColor" />\n              </svg>\n            </div>\n          </div>\n        </label>\n\n      </div>\n    </div>\n  </div>\n\n  <style type="text/css">').concat(c,"</style>\n\n</div>\n    ")}}]),e}()},function(e,t,n){var i;!function(r){"use strict";var s,o,a,l=(s=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,o=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,a=/[^-+\dA-Z]/g,function(e,t,n,i){if(1!==arguments.length||"string"!==d(e)||/\d/.test(e)||(t=e,e=void 0),(e=e||new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var r=(t=String(l.masks[t]||t||l.masks.default)).slice(0,4);"UTC:"!==r&&"GMT:"!==r||(t=t.slice(4),n=!0,"GMT:"===r&&(i=!0));var m=n?"getUTC":"get",p=e[m+"Date"](),f=e[m+"Day"](),_=e[m+"Month"](),g=e[m+"FullYear"](),k=e[m+"Hours"](),b=e[m+"Minutes"](),v=e[m+"Seconds"](),z=e[m+"Milliseconds"](),y=n?0:e.getTimezoneOffset(),x=h(e),w=u(e),C={d:p,dd:c(p),ddd:l.i18n.dayNames[f],dddd:l.i18n.dayNames[f+7],m:_+1,mm:c(_+1),mmm:l.i18n.monthNames[_],mmmm:l.i18n.monthNames[_+12],yy:String(g).slice(2),yyyy:g,h:k%12||12,hh:c(k%12||12),H:k,HH:c(k),M:b,MM:c(b),s:v,ss:c(v),l:c(z,3),L:c(Math.round(z/10)),t:k<12?l.i18n.timeNames[0]:l.i18n.timeNames[1],tt:k<12?l.i18n.timeNames[2]:l.i18n.timeNames[3],T:k<12?l.i18n.timeNames[4]:l.i18n.timeNames[5],TT:k<12?l.i18n.timeNames[6]:l.i18n.timeNames[7],Z:i?"GMT":n?"UTC":(String(e).match(o)||[""]).pop().replace(a,""),o:(y>0?"-":"+")+c(100*Math.floor(Math.abs(y)/60)+Math.abs(y)%60,4),S:["th","st","nd","rd"][p%10>3?0:(p%100-p%10!=10)*p%10],W:x,N:w};return t.replace(s,(function(e){return e in C?C[e]:e.slice(1,e.length-1)}))});function c(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}function h(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var n=new Date(t.getFullYear(),0,4);n.setDate(n.getDate()-(n.getDay()+6)%7+3);var i=t.getTimezoneOffset()-n.getTimezoneOffset();t.setHours(t.getHours()-i);var r=(t-n)/6048e5;return 1+Math.floor(r)}function u(e){var t=e.getDay();return 0===t&&(t=7),t}function d(e){return null===e?"null":void 0===e?"undefined":"object"!=typeof e?typeof e:Array.isArray(e)?"array":{}.toString.call(e).slice(8,-1).toLowerCase()}l.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},l.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},void 0===(i=function(){return l}.call(t,n,t,e))||(e.exports=i)}()},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var i=n(0),r=n.n(i),s=n(1),o=n.n(s),a=function(){function e(t){var n=this;r()(this,e),this.audio=new Audio||document.createElement("video"),this.audio&&t&&(this.onload=!1,this.onplay=!1,this.audio.autoplay=!1,this.audio.load(),this.audio.canPlayType("audio/ogg")?this.audio.src=t+".ogg":this.audio.canPlayType("audio/mp3")&&(this.audio.src=t+".mp3"),this.audio.onloadeddata=function(){n.onload=!0,n.onplay&&n.playAction()})}return o()(e,[{key:"play",value:function(){this.audio&&(this.onload?this.playAction():this.onplay=!0)}},{key:"playAction",value:function(){this.audio.currentTime=0;var e=this.audio.play();e&&e.catch((function(e){}))}}]),e}()},function(e,t,n){var i=n(4),r=n(3);e.exports={name:"mkz_c_mute",mute:null,bind:function(e){var t=this;this.view=e;var n=e.el.querySelector(".mkz-c-js-mute"),r=e.el.querySelector(".mkz-c-js-unmute");i.add(n,"click",(function(){t.setState(!0)})),i.add(r,"click",(function(){t.setState(!1)})),this.getState(),this.render()},getState:function(){return null===this.mute&&(this.mute="true"===localStorage.getItem(this.name)),this.mute},setState:function(e){this.mute=Boolean(e),localStorage.setItem(this.name,Boolean(this.mute)),this.render()},render:function(){this.mute?r.addClass(this.view.elContainer,"mkz-c_mute_yes"):r.removeClass(this.view.elContainer,"mkz-c_mute_yes")}}},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return f}));var i=n(0),r=n.n(i),s=n(1),o=n.n(s),a=n(5),l=n(3),c=n(4),h=n(32),u=h.downlodIcon,d=h.closeIcon,m=h.rightIcon,p=h.leftIcon,f=function(){function e(t,n,i){r()(this,e),this.app=t.app,this.view=t,this.index=n,this.elImages=i,this.total=Object.values(i).length,this.render()}return o()(e,[{key:"t",value:function(e){return a[this.app.locale][e]}},{key:"render",value:function(){this.elContainer&&this.remove();var e=this.elImages.item(this.index).href;l.appendHTML(this.view.elCart,this.template(e,this.index,this.total)),this.elContainer=this.view.elCart.querySelector(".mkz-c-i-js-container"),this.elClose=this.view.elCart.querySelector(".mkz-c-i-js-close"),this.elPrev=this.view.elCart.querySelector(".mkz-c-i-js-prev"),this.elNext=this.view.elCart.querySelector(".mkz-c-i-js-next"),this.bind()}},{key:"remove",value:function(){this.unbind(),this.elContainer.parentNode.removeChild(this.elContainer),delete this.elContainer}},{key:"bind",value:function(){c.add(this.elClose,"click",this.remove.bind(this)),this.elPrev&&c.add(this.elPrev,"click",this.onPrev.bind(this)),this.elNext&&c.add(this.elNext,"click",this.onNext.bind(this)),c.add(window,"keydown",this.onKeyDown.bind(this))}},{key:"unbind",value:function(){c.remove(window,"keydown",this.onKeyDown.bind(this))}},{key:"onKeyDown",value:function(e){"Escape"===e.key&&this.remove(),"ArrowLeft"===e.key&&this.onPrev(),"ArrowRight"===e.key&&this.onNext()}},{key:"onPrev",value:function(){!this.elContainer||this.index<=0||(this.index--,this.render())}},{key:"onNext",value:function(){!this.elContainer||this.index+1>=this.total||(this.index++,this.render())}},{key:"template",value:function(e,t,n){var i=1===n?"":'\n          <div class="mkz-c-preview__prev mkz-c-i-js-prev">\n            '.concat(m,"\n          </div>\n    "),r=1===n?"":'\n          <div class="mkz-c-preview__next mkz-c-i-js-next">\n            '.concat(p,"\n          </div>\n    ");return'\n      <div class="mkz-c-preview mkz-c-i-js-container">\n        <a class="mkz-c-preview__btn mkz-c-preview__btn_type_download" href="'.concat(e,'" target="_blank">\n          ').concat(u,'\n        </a>\n        <div class="mkz-c-preview__btn mkz-c-preview__btn_type_close mkz-c-i-js-close">\n          ').concat(d,'\n        </div>\n        <div class="mkz-c-preview__content">\n          <img src="').concat(e,'" alt="" class="mkz-c-preview__img" />\n        </div>\n        <div class="mkz-c-preview__action">\n          ').concat(i,'\n          <div class="mkz-c-preview__paginate">\n            ').concat(t+1," ").concat(this.t("paginate")," ").concat(n,"\n          </div>\n          ").concat(r,"\n        </div>\n      </div>\n    ")}}]),e}()},function(e,t){e.exports={downlodIcon:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M13 10H18L12 16L6 10H11V3H13V10ZM4 19H20V12H22V20C22 20.2652 21.8946 20.5196 21.7071 20.7071C21.5196 20.8946 21.2652 21 21 21H3C2.73478 21 2.48043 20.8946 2.29289 20.7071C2.10536 20.5196 2 20.2652 2 20V12H4V19Z" fill="currentColor"/>\n</svg>',closeIcon:'<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M16 14.1146L22.6 7.51465L24.4853 9.39998L17.8853 16L24.4853 22.6L22.6 24.4853L16 17.8853L9.39998 24.4853L7.51465 22.6L14.1146 16L7.51465 9.39998L9.39998 7.51465L16 14.1146Z" fill="currentColor"/>\n</svg>',rightIcon:'<svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M2.18154 5L6 8.88906L4.90923 10L5.96244e-08 5L4.90923 -8.95132e-07L6 1.11094L2.18154 5Z" fill="currentColor"/>\n</svg>',leftIcon:'<svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M3.81846 5L9.05114e-07 1.11094L1.09077 -2.14589e-07L6 5L1.09077 10L5.65121e-07 8.88906L3.81846 5Z" fill="currentColor"/>\n</svg>'}},function(e,t){e.exports={trackShow:function(e){mkz("trackSurveyFormShow",{survey_form_uid:e})},trackSubmit:function(e,t){mkz("trackSurveyFormSubmit",{survey_form_uid:e},null,t)}}}]);